"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),powerbi;!function(e){var t;!function(t){var i=e.data.RangeFilterPattern,r=e.data.SQExprBuilder,a=jsCommon.StringExtensions,n=function(){function n(i){i&&(this.preventVirtualKeyboardOnTheFirstTap=i.preventVirtualKeyboardOnTheFirstTap),this.culture=e.formattingService.getCurrentCulture(),this.inputElements=[],this.eventsHelper=new t.SlicerUtil.EventsHelper,this.startInputLabel=i.hostServices.getLocalizedString("Slicer_StartLabel"),this.endInputLabel=i.hostServices.getLocalizedString("Slicer_EndLabel")}return n.prototype.createRange=function(e){return new t.DateRange(e.bounds.min,e.bounds.max,e.value.min,e.value.max)},n.prototype.getSliderOptions=function(e,t){return{min:0,max:100,step:null}},n.prototype.areEqual=function(e,i){return t.DateUtil.isEqual(e,i)},n.prototype.startProperty=function(){return t.slicerProps.data.startDate},n.prototype.endProperty=function(){return t.slicerProps.data.endDate},n.prototype.formatValue=function(t,i){return e.formattingService.formatValue(t,"d")},n.prototype.parseSingleSliderValue=function(e,t){return null},n.prototype.inputStyleProperties=function(){return{background:t.slicerProps.date.background,fontColor:t.slicerProps.date.fontColor,textSize:t.slicerProps.date.textSize,fontFamily:t.slicerProps.date.fontFamily}},n.prototype.parseInput=function(t,i,r){return e.formattingService.parseDate(t)},n.prototype.isInputValid=function(e,t,i,r){return!(null==e||0===i&&e>t.max||1===i&&e<t.min)},n.prototype.setRange=function(t,i,r,n,o,s){null==o?(r.val(e.formattingService.formatValue(t.min,"d")),r.attr("aria-label",a.format(this.startInputLabel,e.formattingService.formatValue(s.min,"d"),e.formattingService.formatValue(t.max,"d"))),n.val(e.formattingService.formatValue(t.max,"d")),n.attr("aria-label",a.format(this.endInputLabel,e.formattingService.formatValue(t.min,"d"),e.formattingService.formatValue(s.max,"d")))):0===o?(r.val(e.formattingService.formatValue(t.min,"d")),r.attr("aria-label",a.format(this.startInputLabel,e.formattingService.formatValue(s.min,"d"),e.formattingService.formatValue(s.max,"d")))):1===o&&(n.val(e.formattingService.formatValue(t.max,"d")),n.attr("aria-label",a.format(this.endInputLabel,e.formattingService.formatValue(s.min,"d"),e.formattingService.formatValue(s.max,"d"))))},n.prototype.enumerateObjectInstances=function(e,t){if("date"===e.objectName&&t&&t.inputStyle)return[{selector:null,objectName:"date",properties:{fontColor:t.inputStyle.fontColor,background:t.inputStyle.background,textSize:t.inputStyle.textSize,fontFamily:t.inputStyle.fontFamily}}]},n.prototype.getDataPointsForSingleValueRange=function(e){return[]},n.prototype.createInputElement=function(e,i){var r=this,a=this.culture.calendar.patterns.d,n=InJs.DomFactory.textBox().attr("type","text").attr(t.RangeSlicerConstants.DisableDragAttribute,"true").prop("readonly",!!this.preventVirtualKeyboardOnTheFirstTap).attr("placeholder",a).addClass(t.RangeSlicerConstants.InputClass.class).appendTo(e);n.datepicker({showOtherMonths:!0,selectOtherMonths:!0,changeMonth:!0,changeYear:!0,nextText:"",prevText:"",firstDay:this.culture.calendar.firstDay,dayNamesMin:this.culture.calendar.days.namesAbbr,dateFormat:this.culture.calendar.patterns.d.replace("yyyy","yy").toLowerCase(),monthNamesShort:this.culture.calendar.months.names,onClose:function(){n.prop("readonly",!!r.preventVirtualKeyboardOnTheFirstTap)}}),n.on("click",function(e){r.preventVirtualKeyboardOnTheFirstTap&&n.is("[readonly]")&&(n.prop("readonly",!1),n.blur()),n.datepicker("show")}),this.preventVirtualKeyboardOnTheFirstTap&&n.on("touchstart",function(e){n.is("[readonly]")||n.is(":focus")||n.focus()});var o=n.datepicker("widget");return n.datepicker("option","beforeShow",function(){r.unregisterPopupHideEvents=r.eventsHelper.onPopupHideEvent(function(e,t){r.onPopupHideEvent(e,t)},e.get(0)),r.fixPosition(o,n,1e3)}),this.inputElements.push(n),n},n.prototype.onPopupHideEvent=function(e,t){if("resize"===e)return void this.hideDatepicker();var i=$(t);i.hasClass("hasDatepicker")||i.hasClass("ui-datepicker")||i.hasClass("ui-icon")||$(i).closest(".ui-datepicker").length||this.hideDatepicker()},n.prototype.hideDatepicker=function(){this.unbindPopupHideEventHandlers();for(var e=0,t=this.inputElements;e<t.length;e++){var i=t[e];i.datepicker("widget").is(":visible")&&i.datepicker("hide").blur()}},n.prototype.onDestroy=function(){this.hideDatepicker()},n.prototype.unbindPopupHideEventHandlers=function(){this.unregisterPopupHideEvents&&this.unregisterPopupHideEvents()},n.prototype.fixPosition=function(e,i,r){var a=this;setTimeout(function(){e.visible(!1,!1,"horizontal")||e.visible(!1,!1,"vertical")?t.SlicerHelper.fixWidgetPosition(e,i,null,!0):r>0&&a.fixPosition(e,i,r-20)},20)},n.prototype.filterExpr=function(e){var t=i.roundUpDateRange(e);return{lower:r.dateTime(t.min),upper:r.dateTime(t.max)}},n.prototype.comparisonKind=function(){return{lower:2,upper:3}},n}();t.DateSlicer=n}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var i=jsCommon.FocusManager,r=jsCommon.PixelConverter,a=10,n="aria-expanded",o="focused",s=function(){function s(e,i){var r=this;this.DefaultRestatementColorName="foregroundDark",this.verticalSlicerRenderer=e,this.popup=$("<div />").addClass("slicer-dropdown-popup"),this.content=$("<div />").addClass("slicer-dropdown-content"),this.hostServices=i.hostServices,this.popup.addClass("visual").attr("focus-nav-mode","Group").keydown(function(e){27!==e.keyCode||r.popup.is(":hidden")||(r.hidePopup(),r.menu.focus(),e.stopPropagation())}),$("body").append(this.popup),this.popup.append(this.content),this.requireUpdate=!0,this.eventsHelper=new t.SlicerUtil.EventsHelper}return s.prototype.onClear=function(){this.verticalSlicerRenderer.onClear()},s.prototype.onModeChange=function(e){this.popup.remove(),this.verticalSlicerRenderer.onModeChange(e)},s.prototype.supportsOrientation=function(){return!1},s.prototype.enumerateObjectInstances=function(e){return this.verticalSlicerRenderer.enumerateObjectInstances(e)},s.prototype.init=function(e,t){return this.container=t,this.style=e.visualInitOptions.style,this.interactivityService=this.verticalSlicerRenderer.init(e,this.content),this.interactivityService},s.prototype.onDestroy=function(){this.unbindPopupHideEventHandlers(),this.popup.remove()},s.prototype.render=function(e){this.options=e,this.requireUpdate=!0,this.renderMenu(),this.popup.is(":hidden")||this.showPopup()},s.prototype.renderMenu=function(){var i,a=this;if(this.menu||(this.menu=InJs.DomFactory.div(),this.menu.addClass("slicer-dropdown-menu"),this.menu.attr((i={role:"combobox",tabindex:"0"},i[n]="false",i)),this.container.append(this.menu),this.menu.click(function(e){a.onRenderMenuClick(e),a.popup.removeClass(o)}),this.menu.keydown(function(e){(40===e.keyCode&&e.altKey===!0||32===e.keyCode||13===e.keyCode)&&(a.onRenderMenuClick(e,!0),a.popup.addClass(o),e.stopPropagation())}),this.restatement=InJs.DomFactory.div(),this.restatement.addClass("slicer-restatement"),this.menu.append(this.restatement),this.icon=$("<i />").addClass("dropdown-chevron"),this.icon.appendTo(this.menu)),this.icon.addClass("powervisuals-glyph"),this.icon.addClass("chevron-down"),this.settings=this.defaultRestatementSetting(),this.options.dataView.metadata&&this.options.dataView.metadata.objects){var s=this.options.dataView.metadata.objects,l=t.ColorHelper.create(this.style);this.settings.selectAllEnabled=e.DataViewObjects.getValue(s,t.slicerProps.selection.selectAllCheckboxEnabled,this.settings.selectAllEnabled),this.settings.background=l.getColorForPropertyWithDefaultColor(s,t.slicerProps.items.background,this.settings.background),this.settings.fontColor=l.getColorForPropertyWithDefaultColor(s,t.slicerProps.items.fontColor,this.settings.fontColor),this.settings.textSize=e.DataViewObjects.getValue(s,t.slicerProps.items.textSize,this.settings.textSize),this.settings.fontFamily=e.DataViewObjects.getValue(s,t.slicerProps.items.fontFamily,this.settings.fontFamily)}this.restatement.text(this.getRestatementText()),this.menu.css({"background-color":this.settings.background||"",color:this.settings.fontColor,"font-size":r.fromPointToPixel(this.settings.textSize),"font-family":this.settings.fontFamily}),this.popup.css({"background-color":this.settings.background||""})},s.prototype.onRenderMenuClick=function(e,t){return e.stopPropagation(),this.popup.is(":hidden")?void this.showPopup(t):void this.hidePopup()},s.prototype.showPopup=function(e){var r=this;window.requestAnimationFrame(function(){if(r.popup){var o=r.menu.width()+a;r.popup.css({width:o}),r.menu.attr(n,"true"),r.icon.removeClass("chevron-down"),r.icon.addClass("chevron-up"),t.SlicerHelper.fixWidgetPosition(r.popup,r.menu,null,!0),r.requireUpdate&&(r.verticalSlicerRenderer.renderVerticalSlicer(r.data,r.options),r.requireUpdate=!1),r.unregisterPopupHideEvents=r.eventsHelper.onPopupHideEvent(function(e,t){r.onPopupHideEvent(e,t)},r.menu.get(0)),r.popup.show(),e&&i.focusChildInGroup(r.popup.get(0))}})},s.prototype.hidePopup=function(){this.popup&&(this.popup.hide(),this.menu.attr(n,"false"),this.icon.removeClass("chevron-up"),this.icon.addClass("chevron-down"),this.unbindPopupHideEventHandlers())},s.prototype.onPopupHideEvent=function(e,t){if("resize"===e)return void this.hidePopup();var i=$(t);i.parents(".slicer-dropdown-popup").length||i.is(".slicer-dropdown-menu")||i.parents(".slicer-dropdown-menu").length||this.hidePopup()},s.prototype.unbindPopupHideEventHandlers=function(){this.unregisterPopupHideEvents&&this.unregisterPopupHideEvents()},s.prototype.defaultRestatementSetting=function(){return{textSize:10,fontFamily:t.Font.Family.regular.css,fontColor:t.ColorHelper.getThemeColor(this.style,this.DefaultRestatementColorName),background:this.style.isHighContrast?t.ColorHelper.getThemeColor(this.style,t.BackgroundColorName):void 0,selectAllEnabled:!1}},s.prototype.getRestatementText=function(){return this.data=this.verticalSlicerRenderer.converter(this.options.dataView),this.data.restatement},s}();t.DropdownSlicerRenderer=s}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var i=jsCommon.Utility.clampValue,r=jsCommon.PixelConverter,a=50,n=80,o=2,s=100,l=.8,c={label:{marginRight:2,paddingLeft:8,paddingRight:8}},d=function(){function d(e,i){this.viewModelAdapter=i,this.textProperties={fontFamily:t.Font.Family.regular.css,fontSize:"14px"},e&&(this.behavior=e.behavior,this.horizontalSlicerLayout=e.horizontalSlicerLayout),this.horizontalSlicerLayout||(this.horizontalSlicerLayout=new u),this.domHelper=new t.SlicerUtil.DOMHelper,this.dataStartIndex=0}return d.prototype.getDefaultValue=function(){if(this.data&&this.data.defaultValue)return this.data.defaultValue.value},d.prototype.getIdentityFields=function(){return t.SlicerUtil.DefaultValueHandler.getIdentityFields(this.dataView)},d.prototype.getUpdatedSelfFilter=function(e){if(this.data.searchKey!==e)return t.SlicerUtil.getUpdatedSelfFilter(e,this.dataView)},d.prototype.supportsOrientation=function(){return!0},d.prototype.enumerateObjectInstances=function(e){var i=this.originalData,r=i?i.slicerSettings:void 0;return r||(r=t.DataConversion.DefaultSlicerProperties(this.style)),t.SlicerUtil.ObjectEnumerator.enumerateObjectInstances(e,i,r,this.dataView)},d.prototype.onModeChange=function(e){t.SlicerUtil.clearSlicerFilter(this.hostServices,e)},d.prototype.getRestatement=function(){return this.data&&this.data.restatement},d.prototype.onClear=function(){this.interactivityService.handleClearSelection(),this.interactivityService.persistSelectionFilter(t.slicerProps.filterPropertyIdentifier)},d.prototype.init=function(e,i){var r=this;this.element=i,this.currentViewport=e.visualInitOptions.viewport;var a=this.hostServices=e.visualInitOptions.host;this.style=e.visualInitOptions.style,this.behavior&&(this.interactivityService=t.createInteractivityService(a)),this.loadMoreData=function(){return e.loadMoreData()};var n=document.createElement("div");n.className=p.Selectors.container.class;var o=this.container=d3.select(n);this.searchContainer=this.domHelper.addSearch(a,o);var s=this.body=o.append("div").classed(t.SlicerUtil.Selectors.Body.class+" "+p.Selectors.FlexDisplay.class,!0);this.leftNavigationArrow=s.append("button").classed(this.horizontalSlicerLayout.getNavigationArrowsClass(!0)),this.itemsContainer=s.append("div").classed(p.Selectors.ItemsContainer.class+" "+p.Selectors.FlexDisplay.class,!0).attr("tabindex","0").attr("role","listbox");var l=this.itemsContainer.node();return $(l).on("keydown",function(e){var t=e.keyCode,i=39===t||40===t,a=37===t||38===t;(i||a)&&(r.focusNextElement(i),e.stopPropagation())}),this.rightNavigationArrow=s.append("button").classed(this.horizontalSlicerLayout.getNavigationArrowsClass(!1)),this.element.get(0).appendChild(n),this.bindNavigationEvents(),this.interactivityService},d.prototype.render=function(e){var i=this.hostServices.getLocalizedString(t.SlicerUtil.DisplayNameKeys.SelectAll),r=e.dataView;return this.originalData=this.data=t.DataConversion.convert(r,i,this.interactivityService,this.hostServices,this.style),this.viewModelAdapter&&(this.data=this.viewModelAdapter.applyChanges(e.viewport,this.originalData,r)),r&&this.data&&!_.isEmpty(this.data.slicerDataPoints)?(this.dataView=r,this.currentViewport&&e.viewport&&(this.currentViewport.height!==e.viewport.height||this.currentViewport.width!==e.viewport.width)&&!this.isMaxDimensionsNeedsReCalculate()||this.calculateAndSetMaxItemDimensions(),this.currentViewport=e.viewport,this.updateStyle(e.hasSearchableData),this.itemsToDisplay=this.horizontalSlicerLayout.calculateNumberOfItemsToDisplay(this.element,this.totalItemWidth,this.totalItemHeight,this.getDataPointsCount()),void(0!==this.itemsToDisplay&&this.renderCore())):void this.itemsContainer.selectAll("*").remove()},d.prototype.renderCore=function(){this.horizontalSlicerLayout.renderCore&&this.horizontalSlicerLayout.renderCore(this.container);var e=this.data;if(e&&e.slicerDataPoints){this.normalizePosition();var t=this.getDataPointsCount(),i=this.itemsToDisplay,r=this.dataStartIndex;this.container.classed(p.Selectors.CanScrollRight.class,r+this.itemsToDisplay<=t-1),this.container.classed(p.Selectors.CanScrollLeft.class,r>0),this.renderItems(e.slicerSettings),this.bindInteractivityService(),r+i>=t*l&&this.loadMoreData()}},d.prototype.updateStyle=function(e){var i=this.data,r=i.slicerSettings,a=e&&r.search.enabled;this.container.classed(p.Selectors.MultiSelectEnabled.class,!r.selection.singleSelect),this.searchContainer.classed(t.SlicerUtil.Selectors.SearchHeaderShow.class,a),this.searchContainer.classed(t.SlicerUtil.Selectors.SearchHeaderCollapsed.class,!a)},d.prototype.renderItems=function(i){var a=this,n=this.itemsToDisplay,o=this.dataStartIndex,s=this.data.slicerDataPoints.slice(o,o+n),l=this.horizontalSlicerLayout.bindData(s,this.data,this.itemsContainer);l.enter().append("div").classed(p.Selectors.IndividualItemContainer.class,!0).attr("role","option").attr("tabindex",0).each(function(e){var i,r=d3.select(this);if(e.isImage){var a=r.append("div").classed(p.Selectors.ImageContainer.class,!0);a.append("div").classed(p.Selectors.Input.class,!0).append("input").attr("type","checkbox"),a.append("img").classed(p.Selectors.HorizontalSlicerImage.class,!0)}else r.append("div").classed((i={},i[t.SlicerUtil.Selectors.LabelText.class]=!0,i[p.Selectors.FlexDisplay.class]=!0,i))}),l.attr("aria-selected",function(e){return e.selected===!0}),l.order(),l.select(t.SlicerUtil.Selectors.LabelText.selector).style({"padding-left":r.toString(c.label.paddingLeft),"padding-right":r.toString(c.label.paddingRight)}),l.style({"margin-right":function(e,t){return a.horizontalSlicerLayout.getDataPointRightMargin(t,a.itemsToDisplay)}}),this.domHelper.setSlicerTextStyle(l,i),l.exit().remove(),this.animationFrameId&&window.cancelAnimationFrame(this.animationFrameId),this.animationFrameId=window.requestAnimationFrame(function(){l.select("img").attr("title",function(e){return e.tooltip}).attr("src",function(e){return e.value}),l.select(t.SlicerUtil.Selectors.LabelText.selector).attr("title",function(e){return e.tooltip}).text(function(e){return e.value});var i=a.element.find(t.SlicerUtil.Selectors.LabelText.selector),r=i.first(),n=r.height(),o=r.width();i.each(function(t,i){e.TextMeasurementService.wordBreakOverflowingText(i,o,n)})})},d.prototype.bindInteractivityService=function(){var e=p.Selectors.IndividualItemContainer.selector;if(this.interactivityService&&this.body){var i=this.body,r=i.selectAll(p.Selectors.ItemsContainer.selector),a=i.selectAll(e),n=this.data,o=this.searchContainer.select("input");if(!o.empty()){var s=o.node(),l=s.value;(_.isEmpty(l)||_.isEmpty(n.searchKey))&&o.property("value",n.searchKey)}var c={dataPoints:n.slicerDataPoints,slicerContainer:this.container,itemsContainer:r,itemLabels:a,interactivityService:this.interactivityService,settings:n.slicerSettings,slicerValueHandler:this,searchInput:o,style:this.style},d={behaviorOptions:c,orientation:1};this.interactivityService.bind(n.slicerDataPoints,this.behavior,d,{overrideSelectionFromData:!0,hasSelectionOverride:n.hasSelectionOverride}),t.SlicerWebBehavior.styleSlicerItems(this.itemsContainer.selectAll(e),this.interactivityService.hasSelection(),this.interactivityService.isSelectionModeInverted(),this.style)}else t.SlicerWebBehavior.styleSlicerItems(this.itemsContainer.selectAll(e),!1,!1,this.style)},d.prototype.normalizePosition=function(){var e=this.getDataPointsCount(),t=this.horizontalSlicerLayout.getLastStartIndex(this.itemsToDisplay,e);this.dataStartIndex=i(this.dataStartIndex,0,t)},d.prototype.bindNavigationEvents=function(){this.registerMouseWheelScrollEvents(),this.registerMouseClickEvents()},d.prototype.registerMouseClickEvents=function(){var e=this,t=this.container.selectAll(p.Selectors.RightNavigationArrow.selector),i=this.container.selectAll(p.Selectors.LeftNavigationArrow.selector);t.on("click",function(){e.scrollRight()}),i.on("click",function(){e.scrollLeft()})},d.prototype.registerMouseWheelScrollEvents=function(){var e=this,t=this.body.node();t.addEventListener("mousewheel",function(t){e.onMouseWheel(t.wheelDelta)}),t.addEventListener("DOMMouseScroll",function(t){e.onMouseWheel(t.detail)})},d.prototype.onMouseWheel=function(e){e<0?this.scrollRight():e>0&&this.scrollLeft()},d.prototype.scrollRight=function(){var e=this.horizontalSlicerLayout.getLastStartIndex(this.itemsToDisplay,this.getDataPointsCount());this.dataStartIndex!==e&&(this.dataStartIndex+=this.horizontalSlicerLayout.getScrollSize(this.itemsToDisplay),this.dataStartIndex=Math.min(this.dataStartIndex,e),this.renderCore())},d.prototype.scrollLeft=function(){0!==this.dataStartIndex&&(this.dataStartIndex-=this.horizontalSlicerLayout.getScrollSize(this.itemsToDisplay),this.dataStartIndex=Math.max(this.dataStartIndex,0),this.renderCore())},d.prototype.getScaledTextWidth=function(e){return e/jsCommon.TextSizeDefaults.TextSizeMin*n},d.prototype.isMaxDimensionsNeedsReCalculate=function(){if(!this.lastCalculatedProperties)return!0;var e=this.data.slicerSettings,t=e.general.outlineWeight,i=e.slicerText,r=i.outline,a=i.textSize,n=i.fontFamily,o=this.lastCalculatedProperties;return o.textSize!==a||o.fontFamily!==n||o.outline!==r||o.outlineWeight!==t||o.hasImage!==this.data.hasImages},d.prototype.calculateAndSetMaxItemDimensions=function(){var t,i,n=this.data,l=this.data.slicerSettings,d=this.getDataPointsCount(),u=0,p=0,h=l.slicerText.outline,v=l.general.outlineWeight;if(0===d)u=0,p=0;else if(n.hasImages)u=s,p=s;else{var S=n.slicerDataPoints,m=Math.min(d,a),g=jQuery.extend(!0,{},this.textProperties);t=l.slicerText.textSize,i=l.slicerText.fontFamily,g.fontSize=r.fromPoint(t),g.fontFamily=i,g.text="Sample";for(var f=jsCommon.WordBreaker.getMaxWordWidth,y=e.TextMeasurementService.measureSvgTextHeight(g),b=0;b<m;b++){var C=S[b].value;g.text=C,u=Math.max(u,f(C,e.TextMeasurementService.measureSvgTextWidth,g));var w=Math.min(o,jsCommon.WordBreaker.wordCount(C));p=Math.max(p,y*w)}u=Math.min(u,this.getScaledTextWidth(t))}var x=c.label.paddingLeft+c.label.paddingRight+c.label.marginRight,P=this.domHelper.getRowsOutlineWidth(h,v);this.totalItemWidth=u+x+P,this.totalItemHeight=p+x+P;var I=this.horizontalSlicerLayout.calculateTotalItemDimensions(this.totalItemWidth,this.totalItemHeight);this.totalItemWidth=I.width,this.totalItemHeight=I.height,this.lastCalculatedProperties={outline:h,outlineWeight:v,textSize:t,fontFamily:i,hasImage:n.hasImages}},d.prototype.focusNextElement=function(e){var t,i=$(document.activeElement).hasClass(p.Selectors.ItemsContainer.class);i?e&&(t=document.activeElement.firstChild):e?(t=document.activeElement.nextElementSibling,t||this.scrollRight(),t=document.activeElement.nextElementSibling):(t=document.activeElement.previousElementSibling,t||this.scrollLeft(),t=document.activeElement.previousElementSibling),t&&t.focus()},d.prototype.getDataPointsCount=function(){return _.size(this.data.slicerDataPoints)},d.prototype.addWarnings=function(e){t.SlicerUtil.addWarningsToSlicerVisual(this.data.warnings,e)},d}();t.HorizontalSlicerRenderer=d;var u=function(){function e(){}return e.prototype.bindData=function(e,i,r){return r.selectAll(p.Selectors.IndividualItemContainer.selector).data(e,function(e){return t.SlicerUtil.getDataPointIndex(e,i)})},e.prototype.calculateTotalItemDimensions=function(e,t){return{width:e,height:t}},e.prototype.calculateNumberOfItemsToDisplay=function(r,a,n,o){var s=r.find(t.SlicerUtil.Selectors.Body.selector),l=s.width()-2*e.NavigationArrowWidth;return 0===a?0:i(Math.round(l/a),1,o)},e.prototype.getNavigationArrowsClass=function(e){var t,i;return e?(t={},t[p.Selectors.NavigationArrow.class]=!0,t[p.Selectors.LeftNavigationArrow.class]=!0,t):(i={},i[p.Selectors.NavigationArrow.class]=!0,i[p.Selectors.RightNavigationArrow.class]=!0,i)},e.prototype.getScrollSize=function(e){return 1===e?e:e-1},e.prototype.getLastStartIndex=function(e,t){return t-e},e.prototype.getDataPointRightMargin=function(e,t){return this.isLastRowItem(e,t)?"0px":r.toString(c.label.marginRight)},e.prototype.isLastRowItem=function(e,t){return e===t-1},e.NavigationArrowWidth=19,e}();t.HorizontalSlicerLayout=u;var p;!function(e){var t;!function(e){var t=jsCommon.CssConstants.createClassAndSelector;e.container=t("horizontalSlicerContainer"),e.ItemsContainer=t("slicerItemsContainer"),e.NavigationArrow=t("navigationArrow"),e.LeftNavigationArrow=t("left"),e.RightNavigationArrow=t("right"),e.MultiSelectEnabled=t("isMultiSelectEnabled"),e.FlexDisplay=t("flexDisplay"),e.CanScrollRight=t("canScrollRight"),e.CanScrollLeft=t("canScrollLeft"),e.IndividualItemContainer=t("individualItemContainer"),e.ImageContainer=t("horizontalImageContainer"),e.HorizontalSlicerImage=t("horizontalSlicerImage"),e.Input=t("slicerCheckbox")}(t=e.Selectors||(e.Selectors={}))}(p=t.HorizontalSlicer||(t.HorizontalSlicer={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=function(){function t(){}return t.prototype.bindEvents=function(t,i){this.itemLabels=t.itemLabels,this.dataPoints=t.dataPoints,this.interactivityService=t.interactivityService,this.slicerSettings=t.settings,this.style=t.style,e.SlicerWebBehavior.bindSlicerEvents(t,this.itemLabels,i,this.slicerSettings,this.interactivityService)},t.prototype.renderSelection=function(t){e.SlicerWebBehavior.setSelectionOnSlicerItems(this.itemLabels,this.itemLabels,t,this.interactivityService,this.slicerSettings,this.style)},t}();e.HorizontalSlicerWebBehavior=t}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var i=e.data.SQExprBuilder,r=jsCommon.StringExtensions;t.NumericSlicerOptions=e.createEnumType([{value:t.slicerMode.between,displayName:function(e){return e.get("Visual_SliderMode_Between")}},{value:t.slicerMode.before,displayName:function(e){return e.get("Visual_SliderMode_LessThanEqualLabel")}},{value:t.slicerMode.after,displayName:function(e){return e.get("Visual_SliderMode_GreaterThanEqualLabel")}},{value:t.slicerMode.basic,displayName:function(e){return e.get("Visual_SliderMode_Basic")}},{value:t.slicerMode.dropdown,displayName:function(e){return e.get("Visual_SliderMode_Dropdown")}},{value:t.slicerMode.single,displayName:function(e){return e.get("Visual_SliderMode_SingleVal")}}]);var a=function(){function e(e){this.startInputLabel=e.hostServices.getLocalizedString("Slicer_StartLabel"),this.endInputLabel=e.hostServices.getLocalizedString("Slicer_EndLabel")}return e.prototype.createRange=function(e){return e.isSourceInteger?new t.NonScaledNumericRange(e.bounds.min,e.bounds.max,e.value.min,e.value.max):new t.NumericRange(e.bounds.min,e.bounds.max,e.value.min,e.value.max)},e.prototype.areEqual=function(e,t){return e===t},e.prototype.startProperty=function(){return t.slicerProps.data.numericStart},e.prototype.endProperty=function(){return t.slicerProps.data.numericEnd},e.prototype.parseSingleSliderValue=function(e,t){var i=t[e];return{min:i,max:i}},e.prototype.formatValue=function(e,t){return t?t.format(e):e.toString()},e.prototype.getSliderOptions=function(e,t){var i={min:0,max:100,step:null};return t?(i.max=e.dataPoints.length-1,i.step=1):e.isSourceInteger&&(i.min=e.bounds.min,i.max=e.bounds.max,i.step=1),i},e.prototype.inputStyleProperties=function(){return{background:t.slicerProps.numericInputStyle.background,fontColor:t.slicerProps.numericInputStyle.fontColor,textSize:t.slicerProps.numericInputStyle.textSize,fontFamily:t.slicerProps.numericInputStyle.fontFamily}},e.prototype.parseInput=function(e,t,i){var r=parseFloat(e);return i&&$.isNumeric(r)?_.indexOf(t,r)>-1?r:this.findClosestPoint(r,t):r},e.prototype.findClosestPoint=function(e,t){for(var i=_.head(t),r=Math.abs(i-e),a=1;a<t.length;a++){var n=Math.abs(t[a]-e);n<r&&(r=n,i=t[a])}return i},e.prototype.isInputValid=function(e,t,i,r){return!(!$.isNumeric(e)||0===i&&e>t.max||1===i&&e<t.min||r&&e===t.min)},e.prototype.setRange=function(e,t,i,a,n,o){null==n?(i.val(t.format(e.min)),i.attr("aria-label",r.format(this.startInputLabel,t.format(o.min),t.format(e.max))),a.val(t.format(e.max)),a.attr("aria-label",r.format(this.endInputLabel,t.format(e.min),t.format(o.max)))):0===n?(i.val(t.format(e.min)),i.attr("aria-label",r.format(this.startInputLabel,t.format(o.min),t.format(o.max)))):1===n&&(a.val(t.format(e.max)),a.attr("aria-label",r.format(this.endInputLabel,t.format(o.min),t.format(o.max))))},e.prototype.createInputElement=function(e,i){return InJs.DomFactory.textBox().attr("type","text").attr(t.RangeSlicerConstants.DisableDragAttribute,"true").addClass(t.RangeSlicerConstants.InputClass.class).appendTo(e)},e.prototype.enumerateObjectInstances=function(e,t){if("numericInputStyle"===e.objectName&&t&&t.inputStyle)return[{selector:null,objectName:"numericInputStyle",properties:{fontColor:t.inputStyle.fontColor,background:t.inputStyle.background,textSize:t.inputStyle.textSize,fontFamily:t.inputStyle.fontFamily}}]},e.prototype.getDataPointsForSingleValueRange=function(e){var t=e.categorical.categories[0],i=t&&t.values||[],r=_.filter(i,function(e){return $.isNumeric(e)});return r=_.sortBy(r,function(e){return e}),r=_.uniq(r)},e.prototype.filterExpr=function(e){return{lower:i.double(e.min),upper:i.double(e.max)}},e.prototype.comparisonKind=function(){return{lower:2,upper:4}},e}();t.NumericSlicer=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){function i(e){return{textSize:9,fontFamily:t.Font.Family.regular.css,fontColor:t.ColorHelper.getThemeColor(e,b),background:null}}function r(e){return{color:t.ColorHelper.getThemeColor(e,C),show:!0,drawRoundSliderHandles:!1,minSliderVisibilityHeight:d,minSliderVisibilityWidth:c}}var a,n=jsCommon.Color,o=jsCommon.CssConstants,s=jsCommon.PixelConverter,l=e.data.SQExprBuilder,c=150,d=0,u=9,p="Segoe UI,wf_segoe-ui_normal,helvetica,arial,sans-serif",h=o.createClassAndSelector("date-slicer-range"),v=o.createClassAndSelector("date-slicer"),S=o.createClassAndSelector("date-slicer-head"),m=o.createClassAndSelector("date-slicer-slider"),g=o.createClassAndSelector("date-slicer-control"),f=o.createClassAndSelector("roundHandles"),y=o.createClassAndSelector("wrap"),b="foregroundDark",C="foregroundNeutralSecondary";!function(e){e.InputClass=o.createClassAndSelector("date-slicer-input"),e.DisableDragAttribute="drag-resize-disabled"}(a=t.RangeSlicerConstants||(t.RangeSlicerConstants={})),t.RangeSlicerSupportedModes=[t.slicerMode.after,t.slicerMode.before,t.slicerMode.between];var w=function(){function o(e,t,i,r){this.viewModelAdapter=r,this.isRendered=!1,e&&(this.hostServices=e.hostServices),this.rangeSlicerRenderer=t,this.singleValue=i}return Object.defineProperty(o.prototype,"defaultSliderMode",{get:function(){return this.singleValue?t.slicerMode.single:t.slicerMode.between},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"activeMode",{get:function(){return this.data.mode||this.defaultSliderMode},enumerable:!0,configurable:!0}),o.prototype.init=function(e,t){this.options=e,this.host=t,this.style=e.visualInitOptions.style},o.prototype.onModeChange=function(e){if(_.indexOf(t.RangeSlicerSupportedModes,e)>-1){if(!this.data)return;this.updateMode(e)}else t.SlicerUtil.clearSlicerFilter(this.hostServices,e)},o.prototype.onClear=function(){this.data&&this.data.initialValue&&(this.data.value=this.data.initialValue,this.data.state=0,this.updateProperties())},o.prototype.render=function(i){if(!_.isEmpty(i.dataView)){if(this.dataView=i.dataView,this.reader=e.data.createDataViewCategoricalReaderAdvanced(this.dataView),!this.isValid(this.reader))return void(this.isRendered&&(this.disableSlicer(),this.hostServices.setWarnings([new t.DateSlicerNoDataWarning])));this.isRendered&&this.enableSlicer(),this.originalData=this.data=this.converter(this.reader,i),this.viewModelAdapter&&(this.data=this.viewModelAdapter.applyChanges(i.viewport,this.originalData,this.dataView)),this.isRendered||this.initControls(),this.rangeSlicerRenderer.setRange(this.data.value,this.data.formatter,this.start,this.end,null,this.data.bounds),this.range=this.rangeSlicerRenderer.createRange(this.data),this.updateInputControls(),this.updateSlider(this.activeMode),this.updateProperties()}},o.prototype.supportsOrientation=function(){return!1},o.prototype.enumerateObjectInstances=function(e){var t=this.originalData;return"date"===e.objectName||"numericInputStyle"===e.objectName?this.rangeSlicerRenderer.enumerateObjectInstances(e,t):"slider"===e.objectName?[{selector:null,objectName:"Slider",properties:{show:t.sliderSettings.show,color:t.sliderSettings.color}}]:void 0},o.prototype.isValid=function(e){if(this.singleValue)return e.columns.getCategoryCount()>0;var i=e.columns.getMetadataColumns(t.slicerRoles.value);if(!_.isEmpty(i)){var r=i[0];if(r.aggregates&&null!=r.aggregates.min&&null!=r.aggregates.max)return!0}return!1},o.prototype.converter=function(a,o){var s={state:0,mode:null,formatter:null,identity:null,value:null,initialValue:null,bounds:null,filter:null,properties:{filter:null},sliderSettings:r(this.style),inputStyle:i(this.style),dataPoints:null,wrapRangeBoxes:!1,isSourceInteger:!1},l=a.columns.getMetadataColumns(t.slicerRoles.value),c=l[0],d=t.valueFormatter.getFormatString(c,t.slicerProps.formatString);s.isSourceInteger=c.type.integer===!0,s.formatter=t.valueFormatter.createDefaultFormatter(d),s.identity=c.expr;var u=null,p=null;if(this.singleValue)s.dataPoints=this.rangeSlicerRenderer.getDataPointsForSingleValueRange(this.dataView),s.dataPoints.length>0&&(u=s.dataPoints[0],p=s.dataPoints[s.dataPoints.length-1]);else{var h=c.aggregates;u=h.min,p=h.max}s.value={min:u,max:p},s.initialValue={
min:u,max:p},s.bounds={min:s.value.min,max:s.value.max};var v=a.objects.getStaticObjects();if(v){s.filter=e.DataViewObjects.getValue(v,t.slicerProps.filterPropertyIdentifier),s.properties.start=e.DataViewObjects.getValue(v,this.rangeSlicerRenderer.startProperty(),null),s.properties.end=e.DataViewObjects.getValue(v,this.rangeSlicerRenderer.endProperty(),null),s.properties.mode=e.DataViewObjects.getValue(v,t.slicerProps.data.mode,null);var S=this.rangeSlicerRenderer.inputStyleProperties(),m=t.ColorHelper.create(this.style);s.inputStyle.background=m.getColorForPropertyWithDefaultColor(v,S.background,s.inputStyle.background),s.inputStyle.fontColor=m.getColorForPropertyWithDefaultColor(v,S.fontColor,s.inputStyle.fontColor),s.inputStyle.textSize=e.DataViewObjects.getValue(v,S.textSize,s.inputStyle.textSize),s.inputStyle.fontFamily=e.DataViewObjects.getValue(v,S.fontFamily,s.inputStyle.fontFamily),s.sliderSettings.color=m.getColorForPropertyWithDefaultColor(v,t.slicerProps.slider.color,s.sliderSettings.color),s.sliderSettings.show=e.DataViewObjects.getValue(v,t.slicerProps.slider.show,s.sliderSettings.show),null!==s.properties.start&&(s.state|=1,s.value.min=s.properties.start,s.properties.start<s.bounds.min&&(s.bounds.min=s.properties.start)),null!==s.properties.end&&(s.state=s.state|=2,s.value.max=s.properties.end,s.properties.end>s.bounds.max&&(s.bounds.max=s.properties.end)),s.value.min>s.bounds.max&&(s.value.max=s.bounds.max=s.value.min),s.value.max<s.bounds.min&&(s.value.min=s.bounds.min=s.value.max),null!=s.properties.mode&&(s.mode=s.properties.mode),s.filter&&(s.properties.filter={min:s.value.min,max:s.value.max})}else s.state=0,s.properties.start=null,s.properties.end=null,s.properties.mode=null;var g=n.parseColorString(s.sliderSettings.color);return s.sliderSettings.activeColor=n.calculateHighlightColor(g,.5,.2),s.sliderSettings.hoverColor=n.hexString(n.darken(g,100)),s.properties.bounds={min:s.bounds.min,max:s.bounds.max},s},o.prototype.initControls=function(){this.isRendered=!0,this.createHtmlControls(),this.updateMode(this.data.mode)},o.prototype.createHtmlControls=function(){this.container=InJs.DomFactory.div().addClass(v.class).appendTo(this.host),this.container.on("keyup keydown",function(e){9!==e.keyCode&&27!==e.keyCode&&e.stopPropagation()});var e=InJs.DomFactory.div().addClass(S.class).css(this.getFontStyles()).appendTo(this.container),i=InJs.DomFactory.div().addClass(h.class).appendTo(e);if(this.startContainer=InJs.DomFactory.div().addClass(g.class).appendTo(i),this.endContainer=InJs.DomFactory.div().addClass(g.class).appendTo(i),this.start=this.rangeSlicerRenderer.createInputElement(this.startContainer,0),this.end=this.rangeSlicerRenderer.createInputElement(this.endContainer,1),t.SlicerUtil.enableHover()){var r=t.SlicerUtil.Selectors.EnableHover.class;this.start.addClass(r),this.end.addClass(r)}this.bindEventHandlersToInputElements(),this.sliderContainer=InJs.DomFactory.div().addClass(m.class).appendTo(this.container)},o.prototype.bindEventHandlersToInputElements=function(){var e=this;this.start.on("click touchend",function(e){e.stopPropagation()}),this.end.on("click touchend",function(e){e.stopPropagation()}),this.start.on("change",function(t){e.onRangeChange(0)}),this.start.on("keyup",function(t){13===t.which&&(e.start.blur(),e.start.focus())}),this.start.on("focus",function(t){e.singleValue&&!e.data.filter||e.start.val(e.rangeSlicerRenderer.formatValue(e.data.value.min,null)),e.start.select()}),this.start.on("blur",function(t){e.singleValue&&!e.data.filter||e.start.val(e.rangeSlicerRenderer.formatValue(e.data.value.min,e.data.formatter))}),this.end.on("change",function(t){e.onRangeChange(1)}),this.end.on("keyup",function(t){13===t.which&&(e.end.blur(),e.end.focus())}),this.end.on("focus",function(t){e.end.val(e.rangeSlicerRenderer.formatValue(e.data.value.max,null)),e.end.select()}),this.end.on("blur",function(t){e.end.val(e.rangeSlicerRenderer.formatValue(e.data.value.max,e.data.formatter))})},o.prototype.onRangeChange=function(e){var t=0===e?this.start.val():this.end.val(),i=this.rangeSlicerRenderer.parseInput(t,this.data.dataPoints,this.singleValue);this.rangeSlicerRenderer.isInputValid(i,this.data.value,e,this.singleValue)?this.updateRange({min:i,max:i},e):this.rangeSlicerRenderer.setRange(this.data.value,this.data.formatter,this.start,this.end,e,this.data.bounds)},o.prototype.onDestroy=function(){this.rangeSlicerRenderer.onDestroy&&this.rangeSlicerRenderer.onDestroy()},o.prototype.getFontStyles=function(){var e;return e={},e["font-size"]=s.fromPointToPixel(u),e["font-family"]=p,e["font-weight"]=t.NewDataLabelUtils.defaultFontProperties.weight,e},o.prototype.updateSliderControl=function(){var e=this,i=this.createSliderOptions();if(this.shouldRecreateSlider(i))this.sliderOptions=i,this.slider&&(this.slider.destroy(),this.sliderContainer.empty()),this.mode=this.activeMode,this.sliderElement=InJs.DomFactory.div().attr(a.DisableDragAttribute,"true").appendTo(this.sliderContainer),noUiSlider.create(this.sliderElement.get(0),this.sliderOptions),this.slider=this.sliderElement.get(0).noUiSlider,this.slider.on("slide",function(t,i,r){window.requestAnimationFrame(function(){var t=e.parseSliderValue(r);e.rangeSlicerRenderer.setRange(t,e.data.formatter,e.start,e.end,null,e.data.bounds)})}),this.slider.on("change",function(t,i,r){var a=e.sliderElement.hasClass("noUi-state-tap")?300:0;setTimeout(function(){var t=e.parseSliderValue(r),a=e.getChangeType(e.activeMode,i);e.updateRange(t,a)},a)}),this.applyHandlesHoverState(this.sliderContainer.find(".noUi-handle"));else{var r=[];if(this.singleValue){var n=_.indexOf(this.data.dataPoints,this.data.value.min);r.push(n)}else{var o=this.range.getScaledValue();this.activeMode!==t.slicerMode.before&&r.push(o.min),this.activeMode!==t.slicerMode.after&&r.push(o.max)}this.slider.set(r)}this.sliderContainer.find(".noUi-connect").css({"background-color":this.data.sliderSettings.color}),this.sliderContainer.find(".noUi-handle").each(function(t,i){var r=$(i),a=r.is(":hover")?e.data.sliderSettings.activeColor:e.data.sliderSettings.color;e.setSliderHandleColor(r,a)})},o.prototype.setSliderHandleColor=function(e,t){var i={"border-color":"","background-color":""};i[this.data.sliderSettings.drawRoundSliderHandles?"border-color":"background-color"]=t,e.css(i)},o.prototype.disableSlicer=function(){this.disableSlider(),1&this.data.state||(this.start.val(""),this.start.prop("disabled",!0),this.disableInput(this.start,this.data.inputStyle.fontColor)),2&this.data.state||(this.end.val(""),this.end.prop("disabled",!0),this.disableInput(this.end,this.data.inputStyle.fontColor)),this.data.bounds.min=this.data.bounds.max=null,this.updateProperties()},o.prototype.disableSlider=function(){if(this.sliderElement&&this.sliderElement.get(0).setAttribute("disabled","true"),this.sliderContainer.css("opacity","0.1"),this.slider){var e=[0,100];this.slider.set(e)}},o.prototype.enableSlicer=function(){this.sliderElement&&this.sliderElement.get(0).removeAttribute("disabled"),this.sliderContainer.css("opacity","1.0"),this.start.prop("disabled",!1),this.end.prop("disabled",!1)},o.prototype.shouldRecreateSlider=function(e){return!this.slider||!_.isEqual(e,this.sliderOptions)},o.prototype.applyHandlesHoverState=function(e){var t=this,i=!1,r=!1;e.on("mouseover",function(){r=!0,i||t.setSliderHandleColor($(event.target),t.data.sliderSettings.hoverColor)}).on("mouseout",function(){r=!1,i||t.setSliderHandleColor($(event.target),t.data.sliderSettings.color)}).on("mousedown touchstart",function(){i=!0;var e=event.target;t.setSliderHandleColor($(e),t.data.sliderSettings.activeColor);var r=function(){$(document).off("mouseup touchEnd",r),i&&(i=!1,t.setSliderHandleColor($(e),t.data.sliderSettings.color))};$(document).on("mouseup touchEnd",r)}).on("mouseup touchend",function(){i=!1;var e=event.target;t.setSliderHandleColor($(e),r?t.data.sliderSettings.hoverColor:t.data.sliderSettings.color)})},o.prototype.updateInputControls=function(){this.singleValue&&!this.data.filter&&this.start.val("");var e={"font-size":s.fromPointToPixel(this.data.inputStyle.textSize),"font-family":this.data.inputStyle.fontFamily||p,"font-weight":t.NewDataLabelUtils.defaultFontProperties.weight};this.start.parent().css(e),this.end.parent().css(e);var i={color:this.data.inputStyle.fontColor,"background-color":this.data.inputStyle.background?this.data.inputStyle.background:""};this.start.css(i),this.end.css(i)},o.prototype.disableInput=function(e,t){var i=n.parseColorString(t);i.A=.3,e.css({color:n.rgbString(i)})},o.prototype.createSliderOptions=function(){var e,i,r=this.rangeSlicerRenderer.getSliderOptions(this.data,this.singleValue),a=this.range.getScaledValue();switch(this.activeMode){case t.slicerMode.before:e=a.max,i="lower";break;case t.slicerMode.after:e=a.min,i="upper";break;case t.slicerMode.between:e=[a.min,a.max],i=!0;break;case t.slicerMode.single:e=_.indexOf(this.data.dataPoints,this.data.value.min),i=!1}var n={connect:i,behaviour:"tap",range:{min:r.min,max:r.max},start:e};return(this.singleValue||this.data.isSourceInteger)&&(n.step=r.step),n},o.prototype.parseSliderValue=function(e){if((this.data.isSourceInteger||this.singleValue)&&(e=e instanceof Array?[Math.round(e[0]),Math.round(e[1])]:Math.round(e)),this.singleValue)return this.rangeSlicerRenderer.parseSingleSliderValue(e,this.data.dataPoints);var i=this.range.getScaledValue();switch(this.activeMode){case t.slicerMode.before:i.max=e;break;case t.slicerMode.after:i.min=e;break;case t.slicerMode.between:i.min=e[0],i.max=e[1]}return this.range.setScaledValue(i),this.range.getValue()},o.prototype.updateSlider=function(e){e===t.slicerMode.after?(this.end.prop("disabled",!0),this.disableInput(this.end,this.data.inputStyle.fontColor),this.start.prop("disabled",!1)):e===t.slicerMode.before?(this.end.prop("disabled",!1),this.start.prop("disabled",!0),this.disableInput(this.start,this.data.inputStyle.fontColor)):(this.end.prop("disabled",!1),this.start.prop("disabled",!1)),e===t.slicerMode.single?this.endContainer.hide():this.endContainer.show(),!this.data.sliderSettings.show||this.shouldHideSmallSlider()?this.sliderContainer.hide():(this.sliderContainer.show(),this.updateSliderControl()),this.sliderContainer.toggleClass(f.class,!!this.data.sliderSettings.drawRoundSliderHandles),this.container.find(S.selector).toggleClass(y.class,!!this.data.wrapRangeBoxes),this.rangeSlicerRenderer.areEqual(this.data.bounds.min,this.data.bounds.max)&&this.disableSlider()},o.prototype.updateMode=function(e){var i=this.data.mode;null==e?e=this.defaultSliderMode:this.data.mode=e,e===t.slicerMode.before?(i===t.slicerMode.after&&1&this.data.state&&(this.data.value.max=this.data.value.min,this.data.value.min=this.data.bounds.min,this.data.state=2),this.data.state&=-2):e===t.slicerMode.after&&(i===t.slicerMode.before&&2&this.data.state&&(this.data.value.min=this.data.value.max,this.data.state=1),this.data.state&=-3),this.updateProperties()},o.prototype.updateProperties=function(){var e={min:this.data.value.min,max:this.data.value.max},t={min:this.data.bounds.min,max:this.data.bounds.max},i={start:1&this.data.state?this.data.value.min:null,end:2&this.data.state?this.data.value.max:null,mode:this.data.mode,filter:e,bounds:t};if(this.requireToUpdate(i)){this.data.properties.filter=e,this.data.properties.bounds=t;var r=this.createPersistProperties(i,this.data.identity,this.data.state);this.hostServices.persistProperties(r),this.hostServices.onSelect({visualObjects:[]})}},o.prototype.getChangeType=function(e,i){var r=null;switch(e){case t.slicerMode.after:case t.slicerMode.single:r=0;break;case t.slicerMode.before:r=1;break;default:r=0===i?0:1}return r},o.prototype.createPersistProperties=function(e,i,r){var a=null==e.mode?this.defaultSliderMode:e.mode,n=this.createFilter(e,a,r,i),o={merge:[{objectName:"general",selector:void 0,properties:{}}],replace:[{objectName:"data",selector:void 0,properties:{}}],remove:[{objectName:"data",selector:void 0,properties:{}},{objectName:"general",selector:void 0,properties:{}}]};return null!==n?o.merge[0].properties[t.slicerProps.general.filter.propertyName]=n:o.remove[1].properties[t.slicerProps.general.filter.propertyName]=!0,1&r&&null!==e.start?o.replace[0].properties[this.rangeSlicerRenderer.startProperty().propertyName]=e.start:null==e.start&&(o.remove[0].properties[this.rangeSlicerRenderer.startProperty().propertyName]=!0),2&r&&null!==e.end?o.replace[0].properties[this.rangeSlicerRenderer.endProperty().propertyName]=e.end:null==e.end&&(o.remove[0].properties[this.rangeSlicerRenderer.endProperty().propertyName]=!0),null!=e.mode&&(o.replace[0].properties[t.slicerProps.data.mode.propertyName]=e.mode),o},o.prototype.updateRange=function(e,t){null==t?(this.data.value.min=e.min,this.data.value.max=e.max):0===t?(this.data.value.min=e.min,null!==this.data.bounds.min&&!this.singleValue&&this.rangeSlicerRenderer.areEqual(this.data.value.min,this.data.bounds.min)?this.data.state&=-2:this.data.state|=1):1===t&&(this.data.value.max=e.max,null!==this.data.bounds.max&&this.rangeSlicerRenderer.areEqual(this.data.value.max,this.data.bounds.max)?this.data.state&=-3:this.data.state|=2),this.updateProperties()},o.prototype.createFilter=function(i,r,a,n){var o=null,s=i.filter,c=null,d=this.rangeSlicerRenderer.filterExpr(s);if(r===t.slicerMode.single)o=1&a?l.compare(0,n,d.lower):null;else{var u=this.rangeSlicerRenderer.comparisonKind();if(1&a&&2&a){var p=l.compare(u.lower,n,d.lower),h=l.compare(u.upper,n,d.upper);o=l.and(p,h)}else 1&a?o=l.compare(u.lower,n,d.lower):2&a&&(o=l.compare(u.upper,n,d.upper))}return null!==o&&(c=e.data.SemanticFilter.fromSQExpr(o)),c},o.prototype.requireToUpdate=function(e){return(null!==this.data.properties.filter||0!==this.data.state||e.mode!==this.data.properties.mode&&(e.mode!==this.defaultSliderMode||null!==this.data.properties.mode))&&!(null!=this.data.properties.filter&&e.mode===this.data.properties.mode&&this.rangeSlicerRenderer.areEqual(e.start,this.data.properties.start)&&this.rangeSlicerRenderer.areEqual(e.end,this.data.properties.end)&&this.rangeSlicerRenderer.areEqual(e.filter.min,this.data.properties.filter.min)&&this.rangeSlicerRenderer.areEqual(e.filter.max,this.data.properties.filter.max)&&this.rangeSlicerRenderer.areEqual(e.bounds.min,this.data.properties.bounds.min)&&this.rangeSlicerRenderer.areEqual(e.bounds.max,this.data.properties.bounds.max))},o.prototype.shouldHideSmallSlider=function(){var e=this.data.sliderSettings;if(this.container.width()<=e.minSliderVisibilityWidth)return!0;if(e.minSliderVisibilityHeight>0){var t=this.endContainer.position().top+this.endContainer.outerHeight();if(this.container.parent().outerHeight()-t<e.minSliderVisibilityHeight)return!0}return!1},o}();t.RangeSlicer=w}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){function i(e){return{textSize:9,fontFamily:t.Font.Family.regular.css,fontColor:t.ColorHelper.getThemeColor(e,P),background:null}}function r(e){return{duration:e.duration,includeToday:e.includeToday,relativeUnit:a(e.period),relativeQualifier:n(e.range),anchorDate:e.anchorDate}}function a(e){switch(e){case t.relativeSlicerPeriod.days:return l.Day;case t.relativeSlicerPeriod.weeks:return l.Week;case t.relativeSlicerPeriod.calendarWeeks:return l.CalendarWeek;case t.relativeSlicerPeriod.months:return l.Month;case t.relativeSlicerPeriod.calendarMonths:return l.CalendarMonth;case t.relativeSlicerPeriod.years:return l.Year;case t.relativeSlicerPeriod.calendarYears:return l.CalendarYear;default:return}}function n(e){switch(e){case t.relativeSlicerRelativeQualifier.last:return s.Last;case t.relativeSlicerRelativeQualifier.current:return s.Current;case t.relativeSlicerRelativeQualifier.next:return s.Next;default:return}}var o=e.visuals.controls.SelectMenu,s=e.data.RelativeDateQualifier,l=e.data.RelativeDateUnit,c=e.data.RelativeDateRangeHelper,d=e.data.RelativeDateFilterPattern,u=e.data.SemanticFilter,p=jsCommon.PixelConverter,h="relative-slicer",v="selection-container",S="range-menu",m="period-menu",g="slicer-select-menu",f="duration-input",y="restatement-container",b="restatement",C="drag-resize-disabled",w="-",x=".ui-selectmenu-button",P="foregroundDark",I=function(){function s(e){this.isRendered=!1,this.hostServices=e.hostServices}return s.prototype.init=function(e,i){this.options=e,this.host=i,this.isRendered=!1,this.style=e.visualInitOptions.style,this.eventsHelper=new t.SlicerUtil.EventsHelper},s.prototype.onDestroy=function(){this.unregisterSelectMenuCloseEvents&&this.unregisterSelectMenuCloseEvents()},s.prototype.supportsOrientation=function(){return!1},s.prototype.onClear=function(){this.data.range=t.relativeSlicerRelativeQualifier.last,this.data.period=t.relativeSlicerPeriod.none,this.data.duration=1,this.data.filter=null,this.renderInternal(),t.SlicerUtil.clearSlicerFilter(this.hostServices,this.data.mode)},s.prototype.enumerateObjectInstances=function(e){return"dateRange"===e.objectName?[{selector:null,objectName:"dateRange",properties:{includeToday:this.data.includeToday,anchorDate:this.data.anchorDate}}]:"numericInputStyle"===e.objectName?[{selector:null,objectName:"numericInputStyle",properties:{fontColor:this.data.inputStyle.fontColor,background:this.data.inputStyle.background,textSize:this.data.inputStyle.textSize,fontFamily:this.data.inputStyle.fontFamily}}]:void 0},s.prototype.onModeChange=function(e){t.SlicerUtil.clearSlicerFilter(this.hostServices,e)},s.converter=function(r,a){var n={mode:t.slicerMode.relative,range:t.relativeSlicerRelativeQualifier.last,period:t.relativeSlicerPeriod.none,duration:1,includeToday:!0,identity:null,anchorDate:void 0,filter:null,inputStyle:i(a)},o=r.columns.getMetadataColumns(t.slicerRoles.value),s=o[0];n.identity=s.expr;var l=r.objects.getStaticObjects();if(l){var c=t.ColorHelper.create(a);n.filter=e.DataViewObjects.getValue(l,t.slicerProps.filterPropertyIdentifier,n.filter),n.range=e.DataViewObjects.getValue(l,t.slicerProps.data.relativeRange,n.range),n.period=e.DataViewObjects.getValue(l,t.slicerProps.data.relativePeriod,n.period),n.duration=Math.abs(e.DataViewObjects.getValue(l,t.slicerProps.data.relativeDuration,n.duration)),n.includeToday=e.DataViewObjects.getValue(l,t.slicerProps.dateRange.includeToday,n.includeToday),n.anchorDate=e.DataViewObjects.getValue(l,t.slicerProps.dateRange.anchorDate,n.anchorDate),n.inputStyle.background=c.getColorForPropertyWithDefaultColor(l,t.slicerProps.numericInputStyle.background,n.inputStyle.background),n.inputStyle.fontColor=c.getColorForPropertyWithDefaultColor(l,t.slicerProps.numericInputStyle.fontColor,n.inputStyle.fontColor),n.inputStyle.textSize=e.DataViewObjects.getValue(l,t.slicerProps.numericInputStyle.textSize,n.inputStyle.textSize),n.inputStyle.fontFamily=e.DataViewObjects.getValue(l,t.slicerProps.numericInputStyle.fontFamily,n.inputStyle.fontFamily)}return n},s.prototype.render=function(t){var i=this;if(!_.isEmpty(t.dataView)){var r=e.data.createDataViewCategoricalReaderAdvanced(t.dataView);this.data=s.converter(r,this.style),this.isRendered||(this.initControls(),this.unregisterSelectMenuCloseEvents=this.eventsHelper.onPopupHideEvent(function(e,t){i.onSelectMenuClose(e,t)},this.selectionContainer.get(0))),this.updateProperties(this.data.range,this.data.period,this.data.duration),this.renderInternal()}},s.prototype.onSelectMenuClose=function(e,t){$(t).hasClass(g)||$(t).closest("."+g).length||(this.rangeSelectMenu.close(),this.periodSelectMenu.close())},s.prototype.initControls=function(){var e=this;this.isRendered=!0,this.container=InJs.DomFactory.div().addClass(h).appendTo(this.host),this.selectionContainer=InJs.DomFactory.div().addClass(v).appendTo(this.container),this.selectionContainer.on("keyup keydown",function(e){9!==e.keyCode&&27!==e.keyCode&&e.stopPropagation()}),this.rangeSelectMenuContainer=InJs.DomFactory.div().addClass(S).appendTo(this.selectionContainer);var i={onChange:function(t){e.rangeChanged(t)},container:this.rangeSelectMenuContainer,options:this.getSelectMenuOptions(t.relativeSlicerRelativeQualifier.type.members()),className:g,selectedValue:"Select"};this.rangeSelectMenu=new o(i),this.rangeSelectMenu.update({selectedValue:t.relativeSlicerRelativeQualifier.last}),this.durationInput=InJs.DomFactory.textBox().attr("type","text").attr(C,"true").addClass(f).appendTo(this.selectionContainer),this.durationInput.val(this.data.duration.toString()),this.durationInput.on("change",function(t){e.durationChanged()}),this.periodSelectMenuContainer=InJs.DomFactory.div().addClass(m).appendTo(this.selectionContainer);var r={onChange:function(t){e.periodChanged(t)},container:this.periodSelectMenuContainer,options:this.getSelectMenuOptions(t.relativeSlicerPeriod.type.members()),className:g};this.periodSelectMenu=new o(r),this.periodSelectMenu.disableOption(t.relativeSlicerPeriod.none),this.updatePeriod(),this.restatementContainer=InJs.DomFactory.div().addClass(y).appendTo(this.container),this.restatementIcon=$("<i />").addClass("restatement-icon").addClass("pbi-glyph-calendar").appendTo(this.restatementContainer),this.restatement=InJs.DomFactory.div().addClass(b).appendTo(this.restatementContainer),this.restatement.text(this.hostServices.getLocalizedString("ExportData_NoAppliedFiltersText"))},s.prototype.rangeChanged=function(e){this.data.range=e,this.data.range===t.relativeSlicerRelativeQualifier.current?(this.durationInput.val(w),this.durationInput.prop("disabled",!0),this.data.duration=0):(this.durationInput.val()===w?(this.durationInput.val("1"),this.data.duration=1):this.updateDuration(),this.durationInput.prop("disabled",!1)),this.updatePeriod(),this.updateProperties(this.data.range,this.data.period,this.data.duration),this.renderInternal()},s.prototype.periodChanged=function(e){this.updateDuration(),this.updateProperties(this.data.range,e,this.data.duration),this.renderInternal()},s.prototype.durationChanged=function(){this.updateDuration(),this.updateProperties(this.data.range,this.data.period,this.data.duration),this.renderInternal()},s.prototype.renderInternal=function(){var e=p.fromPointToPixel(this.data.inputStyle.textSize),i={"font-size":e,"font-family":this.data.inputStyle.fontFamily,color:this.data.inputStyle.fontColor,"background-color":this.data.inputStyle.background?this.data.inputStyle.background:""};this.durationInput.css(i),i["font-size"]=e-1,this.restatement.css(i);var r=this.rangeSelectMenuContainer.find(x);r.css(i);var a=t.relativeSlicerRelativeQualifier.type.members([this.data.range])[0],n=a.displayName({get:this.hostServices.getLocalizedString});r.attr("title",n);var o=this.periodSelectMenuContainer.find(x);o.css(i);var s=t.relativeSlicerPeriod.type.members([this.data.period])[0],l=s.displayName({get:this.hostServices.getLocalizedString});o.attr("title",l),this.rangeSelectMenu.update({selectedValue:this.data.range}),this.periodSelectMenu.update({selectedValue:this.data.period}),this.periodSelectMenu.disableOption(t.relativeSlicerPeriod.none),0===this.data.duration?(this.durationInput.val(w),this.durationInput.prop("disabled",!0),this.durationInput.attr("title",w)):(this.durationInput.prop("disabled",!1),this.durationInput.val(Math.abs(this.data.duration).toString()),this.durationInput.attr("title",Math.abs(this.data.duration).toString())),this.setRestatement()},s.prototype.updateProperties=function(e,i,r){this.data.range=e;var a=this.data.period!==i;this.data.period=i,this.data.duration=r;var n=null;if(this.data.period!==t.relativeSlicerPeriod.none&&(n=this.createFilter()),null===n&&this.data.filter)return void this.onClear();var o=n?u.fromSQExpr(n):null;u.isSameFilter(o,this.data.filter)&&!a||(this.createAndPersistProperties(o),this.setRestatement())},s.prototype.updateDuration=function(){this.data.range===t.relativeSlicerRelativeQualifier.current?this.data.duration=0:this.isDurationValid()&&(this.data.duration=Math.min(parseInt(this.durationInput.val(),10),this.getDurationMax()))},s.prototype.updatePeriod=function(){var e=t.relativeSlicerPeriod.type.members();if(this.data.range!==t.relativeSlicerRelativeQualifier.current)return void this.periodSelectMenu.update({options:this.getSelectMenuOptions(e)});switch(e=e.filter(function(e){return e.value!==t.relativeSlicerPeriod.weeks&&e.value!==t.relativeSlicerPeriod.months&&e.value!==t.relativeSlicerPeriod.years}),this.data.period){case t.relativeSlicerPeriod.weeks:this.data.period=t.relativeSlicerPeriod.calendarWeeks;break;case t.relativeSlicerPeriod.months:this.data.period=t.relativeSlicerPeriod.calendarMonths;break;case t.relativeSlicerPeriod.years:this.data.period=t.relativeSlicerPeriod.calendarYears}this.periodSelectMenu.update({options:this.getSelectMenuOptions(e),selectedValue:this.data.period})},s.prototype.isDurationValid=function(){var e=parseInt(this.durationInput.val(),10);return $.isNumeric(e)&&e>0},s.prototype.getDurationMax=function(){var e=this.data.period!==t.relativeSlicerPeriod.none?this.data.period:t.relativeSlicerPeriod.days;return c.getDurationMax(n(this.data.range),a(e))},s.prototype.createFilter=function(){var e;if(this.data.identity){var t=r(this.data);e=d.buildFilterCondition({field:this.data.identity,options:t})}return e},s.prototype.createAndPersistProperties=function(e){var i={merge:[],replace:[],remove:[]},r={objectName:"general",selector:null,properties:{}};null!==e?(r.properties[t.slicerProps.general.filter.propertyName]=e,i.merge.push(r)):(r.properties[t.slicerProps.general.filter.propertyName]=!0,i.remove.push(r));var a={objectName:"data",selector:null,properties:{}};null!=this.data.mode&&(a.properties[t.slicerProps.data.mode.propertyName]=this.data.mode),null!=this.data.range&&(a.properties[t.slicerProps.data.relativeRange.propertyName]=this.data.range),null!=this.data.duration&&(a.properties[t.slicerProps.data.relativeDuration.propertyName]=this.data.duration),null!=this.data.period&&(a.properties[t.slicerProps.data.relativePeriod.propertyName]=this.data.period),i.replace.push(a);var n={objectName:"dateRange",selector:null,properties:{}};null!=this.data.includeToday&&(n.properties[t.slicerProps.dateRange.includeToday.propertyName]=this.data.includeToday),this.data.anchorDate&&(n.properties[t.slicerProps.dateRange.anchorDate.propertyName]=this.data.anchorDate),i.replace.push(n),this.hostServices.persistProperties(i),this.hostServices.onSelect({visualObjects:[]})},s.prototype.setRestatement=function(){if(this.data.period===t.relativeSlicerPeriod.none)return void this.restatement.text(this.hostServices.getLocalizedString("ExportData_NoAppliedFiltersText"));var e=r(this.data);this.restatement.text(c.getRestatement(e))},s.prototype.getSelectMenuOptions=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var a=r[i],n=a.displayName({get:this.hostServices.getLocalizedString});t.push({text:n,value:a.value})}return t},s}();t.RelativeSlicer=I}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var i,r=e.data.DefaultSQExprVisitor,a=e.data.SemanticFilter,n=jsCommon.UrlUtils;!function(i){function o(e){return{general:{outlineWeight:1,outlineColor:t.ColorHelper.getThemeColor(e,i.DefaultSlicerOutlineColorName)},slicerText:{color:t.ColorHelper.getThemeColor(e,i.DefaultSlicerTextColorName),outline:t.outline.none,textSize:10,fontFamily:t.Font.Family.regular.css},selection:{selectAllCheckboxEnabled:!1,singleSelect:!0},search:{enabled:!1,color:v,outline:t.outline.bottomOnly,borderColor:p,background:h,fontFamily:t.Font.Family.regular.css,textSize:9}}}function s(i,r,n,o,s){if(i&&i.categorical&&!_.isEmpty(i.categorical.categories)){var c=i.categorical.categories[0].identityFields;if(c){var d=i.metadata&&i.metadata.objects&&e.DataViewObjects.getValue(i.metadata.objects,t.slicerProps.filterPropertyIdentifier),u=o.analyzeFilter({dataView:i,defaultValuePropertyId:t.slicerProps.defaultValue,filter:d,fieldSQExprs:c});if(u){var p=u.filter;if(p&&!a.isSameFilter(p,d)){n.handleClearSelection();var h=t.slicerProps.filterPropertyIdentifier,v={};v[h.propertyName]=u.filter;var S={objectName:h.objectName,selector:void 0,properties:v},m={merge:[S]};o.persistProperties(m)}var g=l(u,i.metadata,i.categorical,r,n,o,s);return g.hasImages=_.some(g.slicerDataPoints,function(e){return e.isImage}),g}}}}function l(i,r,o,s,l,p,h){var v=l&&l.isSelectionModeInverted(),S=i.selectedIdentities,m=!_.isEmpty(S)||v===!0;v=i.filter?i.isNotFilter:e.DataViewObjects.getValue(r.objects,t.slicerProps.data.isInvertedSelectionMode,v),l&&(l.setSelectionModeInverted(v),l.setDefaultValueMode(a.isDefaultFilter(i.filter)));for(var g=o.categories[0],f=g&&g.values?g.values.length:0,y=[],b=t.valueFormatter.getFormatString(g.source,t.slicerProps.formatString),C=0,w=g.objects,x=r&&!_.isEmpty(r.columns)&&t.converterHelper.isImageUrlColumn(r.columns[0]),P=[],I=0;I<f;I++){var V=g.identity&&g.identity[I],R=g.values&&g.values[I],D=void 0;if(w){var M=w[I];D=e.DataViewObjects.getValue(M,t.slicerProps.general.count,D)}var F=!!m&&t.SlicerUtil.tryRemoveValueFromRetainedList(V,S),H=t.valueFormatter.format(R,b),T=x===!0&&n.isValidImageUrl(H),E={value:H,tooltip:H,identity:t.SelectionIdBuilder.builder().withCategory(g,I).createSelectionId(),selected:F,count:D,isImage:T};if(F){var O={displayName:H,identity:V};P.push(O)}y.push(E),E.selected&&C++}if(m&&!_.isEmpty(S)){var k=p.getIdentityDisplayNames(S);if(!_.isEmpty(k))for(var z=0,N=k;z<N.length;z++){var j=N[z];P.push(j);var H=t.valueFormatter.format(j.displayName,b),T=x===!0&&n.isValidImageUrl(H),A={value:H,tooltip:H,identity:t.SelectionIdBuilder.builder().withCategoryIdentity(g,j.identity).createSelectionId(),selected:!0,count:null!=w?0:void 0,isImage:T};y.push(A),C++}}p.setIdentityDisplayNames(P);var L=d(r),W=u(r,h);return W.selection.selectAllCheckboxEnabled&&_.isEmpty(L)&&y.unshift({value:s,tooltip:s,identity:t.SelectionId.createWithMeasure(s),selected:!!v&&0===C,isSelectAllDataPoint:!0,count:void 0}),{categorySourceName:g.source.displayName,slicerSettings:W,slicerDataPoints:y,hasSelectionOverride:m,defaultValue:i.defaultValue,searchKey:L,restatement:c(p,P,v),warnings:new t.VisualWarningBuilder}}function c(e,t,i){return _.isEmpty(t)?e.getLocalizedString("Slicer_Restatement_All"):1!==t.length||i?e.getLocalizedString("Slicer_Restatement_Multiple"):t[0].displayName}function d(i){var r=e.DataViewObjects.getValue(i.objects,t.slicerProps.selfFilterPropertyIdentifier,void 0);if(!r)return"";var a=r.conditions(),n=a[0];if(n){var o=new S;return n.accept(o),o.getValueForField()}}function u(r,a){var n=i.DefaultSlicerProperties(a),o=r.objects,s=r.columns&&_.some(r.columns,function(e){return e.discourageAggregationAcrossGroups}),l=t.ColorHelper.create(a);if(o){n.slicerText.color=l.getColorForPropertyWithDefaultColor(o,t.slicerProps.items.fontColor,n.slicerText.color),n.general.outlineWeight=e.DataViewObjects.getValue(o,t.slicerProps.general.outlineWeight,n.general.outlineWeight),n.general.outlineColor=l.getColorForPropertyWithDefaultColor(o,t.slicerProps.general.outlineColor,n.general.outlineColor);var c=l.getColorForProperty(o,t.slicerProps.items.background,void 0);c&&(n.slicerText.background=c),n.slicerText.outline=e.DataViewObjects.getValue(o,t.slicerProps.items.outline,n.slicerText.outline),n.slicerText.textSize=e.DataViewObjects.getValue(o,t.slicerProps.items.textSize,n.slicerText.textSize),n.slicerText.fontFamily=e.DataViewObjects.getValue(o,t.slicerProps.items.fontFamily,n.slicerText.fontFamily),n.selection.selectAllCheckboxEnabled=!s&&e.DataViewObjects.getValue(o,t.slicerProps.selection.selectAllCheckboxEnabled,n.selection.selectAllCheckboxEnabled),n.selection.singleSelect=s||e.DataViewObjects.getValue(o,t.slicerProps.selection.singleSelect,n.selection.singleSelect),n.search.enabled=e.DataViewObjects.getValue(o,t.slicerProps.general.selfFilterEnabled,n.search.enabled),n.search.outline=e.DataViewObjects.getValue(o,t.slicerProps.searchBox.outline,n.search.outline),n.search.borderColor=l.getColorForPropertyWithDefaultColor(o,t.slicerProps.searchBox.borderColor,n.search.borderColor),n.search.background=l.getColorForPropertyWithDefaultColor(o,t.slicerProps.searchBox.background,n.search.background),
n.search.textSize=e.DataViewObjects.getValue(o,t.slicerProps.searchBox.textSize,n.search.textSize),n.search.fontFamily=e.DataViewObjects.getValue(o,t.slicerProps.searchBox.fontFamily,n.search.fontFamily),n.search.color=l.getColorForPropertyWithDefaultColor(o,t.slicerProps.searchBox.fontColor,n.search.color)}return n}i.DefaultSlicerOutlineColorName="foregroundNeutralSecondaryAlt2",i.DefaultSlicerTextColorName="foregroundNeutralSecondary";var p="#C8C8C8",h="#ffffff",v="#333333";i.DefaultSlicerProperties=o,i.convert=s,i.getRestatement=c;var S=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.visitConstant=function(e){e.type&&e.type.text&&(this.value=e.value)},t.prototype.visitContains=function(e){e.left.accept(this),e.right.accept(this)},t.prototype.visitColumnRef=function(e){this.fieldExpr=e},t.prototype.visitDefault=function(e){this.value=void 0,this.fieldExpr=void 0},t.prototype.getValueForField=function(){return this.fieldExpr&&this.value},t}(r)}(i=t.DataConversion||(t.DataConversion={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){function i(){return t.slicerMode.type.members([t.slicerMode.basic,t.slicerMode.dropdown])}function r(){return t.slicerMode.type.members([t.slicerMode.basic,t.slicerMode.dropdown,t.slicerMode.before,t.slicerMode.after,t.slicerMode.between])}function a(){return t.slicerMode.type.members([t.slicerMode.basic,t.slicerMode.dropdown,t.slicerMode.before,t.slicerMode.after,t.slicerMode.between,t.slicerMode.relative])}function n(){return t.slicerMode.type.members([t.slicerMode.single])}var o=e.visuals.controls,s=jsCommon.FocusManagerEventName,l=jsCommon.FocusManager,c="slicer-header-wrapper",d="slicer-container",u="slicer-content-wrapper",p="full-screen",h="slicerResponsiveIcon",v=function(){function v(e){this.areControlButtonsAlwaysVisible=!1,this.enableInFocusRenderers=!1,this.enableMultiElementRows=!1,this.preventVirtualKeyboardOnTheFirstTap=!1,this.isInFocus=!1,this.hasSearchableData=!1,this.lockKeyboardNavigation=!0,e&&(this.behavior=e.behavior,this.enableInFocusRenderers=e.enableInFocusRenderers,this.enableMultiElementRows=e.enableMultiElementRows,this.preventVirtualKeyboardOnTheFirstTap=e.preventVirtualKeyboardOnTheFirstTap,this.lockKeyboardNavigation=e.lockKeyboardNavigation!==!1),this.domHelper=new t.SlicerUtil.DOMHelper,this.activeMode=t.slicerMode.basic,this.slicerOrientation=0,this.viewModelAdapter=new t.SlicerViewModelAdapter}return v.prototype.init=function(t){var i=this;this.initOptions=t,this.element=t.element,this.style=t.style,this.visibilityHelper=e.requireSync("Visuals/common/responsiveVisualUtil").visibilityHelper(this.element,h),this.currentViewport=t.viewport,this.hostServices=t.host,this.waitingForData=!1,this.container=InJs.DomFactory.div().addClass(d).appendTo(this.element),this.alert=InJs.DomFactory.span().appendTo(this.container).attr("aria-live","polite").attr("role","status").hide(),this.headerContainer=InJs.DomFactory.div().appendTo(this.container).addClass(c),this.slicerContainer=InJs.DomFactory.div().appendTo(this.container).addClass(u),this.lockKeyboardNavigation&&l.initialize(this.container.get(0)),this.initializeSlicerRenderer(),this.container.on(s,function(){i.areControlButtonsAlwaysVisible=!0,i.container.addClass("focused"),i.alert.text(i.activeMode),i.updateSlicerHeader()}),this.container.on("focusin",function(){i.container.addClass("focused")})},v.prototype.destroy=function(){this.slicerRenderer.onDestroy&&this.slicerRenderer.onDestroy()},v.prototype.update=function(t){this.isInFocus=!!t.isInFocus,t.type&e.VisualUpdateType.Resize&&this.resizing(t.viewport),(!t.type||t.type&e.VisualUpdateType.Data)&&this.dataChanged(t.dataViews,t.operationKind)},v.prototype.dataChanged=function(t,i){if(!_.isEmpty(t)){var r=this.dataView;this.dataView=t[0];var a=i!==e.VisualDataChangeOperationKind.Append&&!e.DataViewAnalysis.hasSameCategoryIdentity(r,this.dataView);this.render(a,!0)}},v.prototype.resizing=function(e){this.currentViewport=e,this.render(!1)},v.prototype.enumerateObjectInstances=function(e){if(this.dataView)switch(e.objectName){case"header":case"modeSelection":return this.slicerHeader.enumerateObjectInstances(e);case"general":var t=this.slicerHeader.enumerateObjectInstances(e);if(this.slicerRenderer&&this.slicerRenderer.supportsOrientation()){var i=this.data?this.data.orientation:0;t[0].properties.orientation=i}return this.viewModelAdapter&&this.viewModelAdapter.enumerateObjectInstances(e,t,this.dataView,this.activeMode,this.slicerOrientation),t;default:return this.slicerRenderer.enumerateObjectInstances(e)}},v.prototype.loadMoreData=function(){var e=this.dataView;if(e){var t=e.metadata;!this.waitingForData&&t&&t.segment&&(this.hostServices.loadMoreData(),this.waitingForData=!0)}},v.prototype.onClearSelection=function(){this.interactivityService&&(this.interactivityService.clearSelection(),this.render(!1))},v.converter=function(o){if(o){var s,l=null,c=0,d=!1,u=i(),p=1,h=!1;if(o.metadata&&o.metadata.objects){var v=o.metadata.objects;c=e.DataViewObjects.getValue(v,t.slicerProps.general.orientation,c),l=e.DataViewObjects.getValue(v,t.slicerProps.data.mode,l)}if(o.metadata&&o.metadata.columns){var S=_.filter(o.metadata.columns,function(e){return e.roles&&null!=e.roles[t.slicerRoles.value]});if(!_.isEmpty(S)){var m=S[0];if(h=m.type.text===!0,s=m.displayName,d=m.type.numeric===!0,l=t.SlicerPluginMethods.getValidatedSlicerMode(m,l),m.type.dateTime===!0?u=a():d&&(t.SlicerHelper.SingleValueSlicer&&m.parameter&&(u=_.union(u,n())),t.SlicerHelper.NumericSlicerEnabled&&(u=_.union(u,r()))),t.slicerMode.slicerModeSupportsMinMax(l)){p=m.aggregates&&null!=m.aggregates.min&&null!=m.aggregates.max?p:2}}}return{orientation:c,categorySourceName:s,isCategorySourceNumeric:d,mode:l,switchMode:p,hasSearchableData:h,activeOptions:u,showIcon:!1,showTabularSlicer:!1,warningObjectCollection:new t.VisualWarningBuilder}}},v.prototype.render=function(e,t){this.updateViewport(),this.previousData=this.data,this.data=this.originalData=v.converter(this.dataView),this.viewModelAdapter&&this.dataView&&(this.data=this.viewModelAdapter.applySlicerChanges(this.currentViewport,this.originalData,this.dataView)),this.data&&(this.hasSearchableData=this.data.hasSearchableData),this.renderSlicer(e,t),this.data&&this.data.showIcon?this.visibilityHelper.updateVisibility({showIcon:!0,viewport:this.currentViewport}):this.visibilityHelper.updateVisibility({showIcon:!1})},v.prototype.renderSlicer=function(e,t){this.updateSlicerRendererIfNeeded(),this.updateSlicerHeader(),this.slicerRenderer.render({dataView:this.dataView,viewport:this.currentViewport,resetScrollbarPosition:e,hasSearchableData:this.hasSearchableData});var i=null!=this.slicerRenderer.getRestatement;this.slicerHeader&&this.slicerHeader.setFilterRestatement(i?this.slicerRenderer.getRestatement():void 0,i),t&&(this.waitingForData=!1),this.updateWarnings()},v.prototype.updateSlicerRendererIfNeeded=function(){if(this.enableInFocusRenderers){if(this.container.hasClass(p)!==this.isInFocus)return this.isInFocus?this.container.addClass(p):this.container.removeClass(p),void this.initializeSlicerRenderer()}if(this.data){var e=this.data.mode||t.slicerMode.basic;if(this.activeMode!==e||t.slicerMode.isRangeSlicerMode(this.activeMode)&&this.previousData&&this.previousData.isCategorySourceNumeric!==this.data.isCategorySourceNumeric)this.activeMode=e,this.initializeSlicerRenderer();else{var i=this.data.showTabularSlicer,r=this.data.orientation||0;(this.slicerOrientation!==r||this.previousData&&this.previousData.showTabularSlicer!==i)&&(this.slicerOrientation=r,this.initializeSlicerRenderer())}}},v.prototype.updateViewport=function(){var e={height:this.currentViewport.height};this.container.css(e)},v.prototype.updateSlicerHeader=function(){var t=this;if(this.dataView){var i=e.data.createDataViewCategoricalReader(this.dataView);if(!this.slicerHeader){var r={onClear:function(){t.slicerRenderer&&t.slicerRenderer.onClear()},onChange:function(e){t.slicerRenderer&&t.slicerRenderer.onModeChange(e)},host:this.headerContainer,visibilityState:this.data.switchMode,selectedValue:this.activeMode,hoverContainer:this.element,enableInFocusRenderers:this.enableInFocusRenderers,slicerModeOptions:this.slicerActiveOptions()},a={localize:this.hostServices.getLocalizedString,getViewMode:this.hostServices.getViewMode,applySlicerHeaderChanges:function(e){var i=e;return t.viewModelAdapter&&t.dataView&&t.data&&(i=t.viewModelAdapter.applySlicerHeaderChanges(t.currentViewport,e,t.dataView,t.data)),i}};this.slicerHeader=new o.SlicerHeader(r,a,this.style)}this.slicerHeader.update(i,{text:this.data.categorySourceName,restatement:this.slicerRenderer.getRestatement?this.slicerRenderer.getRestatement():void 0,selectedValue:this.activeMode,visibilityState:this.data.switchMode,isInFocus:this.isInFocus,slicerModeOptions:this.slicerActiveOptions(),areControlButtonsAlwaysVisible:this.areControlButtonsAlwaysVisible})}},v.prototype.slicerActiveOptions=function(){if(this.data.isCategorySourceNumeric&&t.SlicerHelper.NumericSlicerEnabled){for(var e=[],i=0,r=this.data.activeOptions;i<r.length;i++){var a=r[i];e.push(t.NumericSlicerOptions.members([a.value])[0])}return e}return this.data.activeOptions},v.prototype.initializeSlicerRenderer=function(){switch(this.slicerRenderer&&this.slicerRenderer.onDestroy&&this.slicerRenderer.onDestroy(),this.slicerContainer.empty(),this.activeMode){case t.slicerMode.basic:return void this.initializeBasicSlicer();case t.slicerMode.dropdown:return void this.initializeDropdownSlicer();case t.slicerMode.relative:return void this.initializeRelativeSlicer();case t.slicerMode.between:case t.slicerMode.before:case t.slicerMode.after:return void this.initializeRangeSlicer(!1);case t.slicerMode.single:return void this.initializeRangeSlicer(!0);default:return void this.initializeVerticalSlicer()}},v.prototype.initializeBasicSlicer=function(){if(this.enableInFocusRenderers&&this.isInFocus)this.initializeInFocusVerticalSlicer();else switch(this.slicerOrientation){case 1:this.initializeHorizontalOrTabularSlicer();break;case 0:this.initializeVerticalSlicer()}},v.prototype.initializeInFocusVerticalSlicer=function(){var e=this.slicerRenderer=new t.VerticalSlicerRenderer(new t.VerticalSlicerRenderer.CheckListSlicerStrategy,{hostServices:this.hostServices,behavior:this.behavior},this.lockKeyboardNavigation),i=this.createInitOptions();this.interactivityService=e.init(i,this.slicerContainer)},v.prototype.initializeVerticalSlicer=function(){var e=this.slicerRenderer=new t.VerticalSlicerRenderer(new t.VerticalSlicerRenderer.CheckBoxSlicerStrategy,{hostServices:this.hostServices,behavior:this.behavior},this.lockKeyboardNavigation),i=this.createInitOptions();this.interactivityService=e.init(i,this.slicerContainer)},v.prototype.initializeRangeSlicer=function(e){if(this.data.isCategorySourceNumeric){var i=new t.RangeSlicerViewModelAdapter,r=new t.NumericSlicer({hostServices:this.hostServices});this.slicerRenderer=new t.RangeSlicer({hostServices:this.hostServices,behavior:this.behavior},r,e,i)}else{var i=new t.RangeSlicerViewModelAdapter,r=new t.DateSlicer({preventVirtualKeyboardOnTheFirstTap:this.preventVirtualKeyboardOnTheFirstTap,hostServices:this.hostServices});this.slicerRenderer=new t.RangeSlicer({hostServices:this.hostServices,behavior:this.behavior},r,e,i)}var a=this.createInitOptions();this.interactivityService=this.slicerRenderer.init(a,this.slicerContainer)},v.prototype.initializeHorizontalOrTabularSlicer=function(){var e;e=!!this.data&&this.data.showTabularSlicer?new t.TabularSlicerLayout:new t.HorizontalSlicerLayout;var i=new t.HorizontalSlicerViewModelAdapter,r=this.slicerRenderer=new t.HorizontalSlicerRenderer({hostServices:this.hostServices,behavior:this.behavior,horizontalSlicerLayout:e},i),a=this.createInitOptions();this.interactivityService=r.init(a,this.slicerContainer)},v.prototype.initializeRelativeSlicer=function(){var e=this.slicerRenderer=new t.RelativeSlicer({hostServices:this.hostServices,behavior:this.behavior}),i=this.createInitOptions();this.interactivityService=e.init(i,this.slicerContainer)},v.prototype.initializeDropdownSlicer=function(){if(this.enableInFocusRenderers&&this.isInFocus)this.initializeInFocusVerticalSlicer();else{var e={hostServices:this.hostServices,behavior:this.behavior},i=new t.VerticalSlicerRenderer(new t.VerticalSlicerRenderer.CheckBoxSlicerStrategy,e);this.slicerRenderer=new t.DropdownSlicerRenderer(i,e);var r=this.createInitOptions();this.interactivityService=this.slicerRenderer.init(r,this.slicerContainer)}},v.prototype.createInitOptions=function(){var e=this;return{visualInitOptions:this.initOptions,loadMoreData:function(){return e.loadMoreData()},enableMultiElementRows:this.enableMultiElementRows}},v.prototype.updateWarnings=function(){this.data&&(this.slicerHeader.addWarnings(this.data.warningObjectCollection),this.slicerRenderer.addWarnings&&this.slicerRenderer.addWarnings(this.data.warningObjectCollection),this.hostServices.setWarnings(this.data.warningObjectCollection.complete()))},v}();t.Slicer=v}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var i=jsCommon.BrowserUtils,r=jsCommon.DOMConstants,a=jsCommon.KeyUtils,n=e.data.Selector,o="foreground",s="foregroundSelected",l=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.behavior=this.createWebBehavior(e),this.behavior.bindEvents(e.behaviorOptions,t)},e.prototype.renderSelection=function(e){this.behavior.renderSelection(e)},e.bindSlicerEvents=function(t,i,r,a,n){e.bindSlicerItemSelectionEvent(i,r,a,n,t),t.searchInput&&e.bindSlicerSearchEvent(t.searchInput,t.clearSearchTextButton,r,t.slicerValueHandler),e.styleSlicerContainer(t.slicerContainer,n)},e.setSelectionOnSlicerItems=function(i,r,a,n,s,l){if(a||n.isSelectionModeInverted())e.styleSlicerItems(i,a,n.isSelectionModeInverted(),l);else{i.filter(".selected").classed("selected",!1),i.filter(".partiallySelected").classed("partiallySelected",!1);var c=i.selectAll("input");if(c&&c.property("checked",!1),r.style("color",s.slicerText.color),l.isHighContrast){var d=t.ColorHelper.getThemeColor(l,o),u=i.selectAll("span");u&&u.style({"background-color":"","border-color":d,"box-shadow":"none"})}}},e.styleSlicerItems=function(e,i,r,a){e.each(function(e,n){var l=this,c=!1;if(e.isSelectAllDataPoint?i?(l.classList.add("partiallySelected"),c=!1):(l.classList.remove("partiallySelected"),c=r):c=jsCommon.LogicExtensions.XOR(e.selected,r),c){if(l.classList.add("selected"),a.isHighContrast){var d=t.ColorHelper.getThemeColor(a,s),u=l.getElementsByTagName("span")[0];u&&(u.style.backgroundColor=d,u.style.borderColor=d)}}else if(l.classList.remove("selected"),a.isHighContrast){var p=t.ColorHelper.getThemeColor(a,o),u=l.getElementsByTagName("span")[0];u&&(u.style.backgroundColor="",u.style.borderColor=p,u.style.boxShadow="none")}var h=l.getElementsByTagName("input")[0];h&&(h.checked=c)})},e.bindSlicerItemSelectionEvent=function(e,t,i,r,a){var n=this;e.on("keydown",function(e){var o=d3.event.keyCode;32!==o&&13!==o||n.toggleItemSelection(e,t,i,r,a)}).on("click",function(e){n.toggleItemSelection(e,t,i,r,a)})},e.toggleItemSelection=function(i,r,a,o,s){if(d3.event.preventDefault(),i.isSelectAllDataPoint)r.toggleSelectionModeInversion();else{var l=t.InteractivityUtils.getPositionOfLastInputEvent();r.handleSelection(i,e.isMultiSelect(d3.event,a,o),l)}var c=o.isSelectionModeInverted(),d=_.chain(s.dataPoints).filter(function(e){return c?!e.selected:e.selected}).map(function(e){var t=e.identity.getSelector().data;if(t){var i=t[0];if(n.isScopeIdentity(i))return{displayName:e.value,identity:i}}}).filter(function(e){return!!e}).value();r.persistSelectionFilter(t.slicerProps.filterPropertyIdentifier,d)},e.bindSlicerSearchEvent=function(t,n,o,s){var l=this;t.empty()||(t.on(r.keyDownEventName,function(){i.isCtrlOrMeta(d3.event)&&a.isCtrlShortcutKey(d3.event.keyCode)?d3.event.stopPropagation():a.isArrowKey(d3.event.keyCode)||a.isDeleteKey(d3.event.keyCode)?d3.event.stopPropagation():27===d3.event.keyCode?(l.clearSearch(o),d3.event.stopPropagation(),d3.event.preventDefault()):13===d3.event.keyCode&&(e.startSearch(t,o,s),d3.event.stopPropagation())}).on(r.keyUpEventName,_.debounce(function(){e.startSearch(t,o,s)},e.searchInputTimeoutDuration)),n&&!n.empty()&&n.on(r.mouseClickEventName,function(){l.clearSearch(o),d3.event.stopPropagation()}))},e.clearSearch=function(e){e.persistSelfFilter(t.slicerProps.selfFilterPropertyIdentifier,null)},e.startSearch=function(e,i,r){var a=e.node(),n=a&&a.value;if(n=_.trim(n),_.isEmpty(n))return void i.persistSelfFilter(t.slicerProps.selfFilterPropertyIdentifier,null);var o=r.getUpdatedSelfFilter(n);o&&i.persistSelfFilter(t.slicerProps.selfFilterPropertyIdentifier,o)},e.styleSlicerContainer=function(e,t){var i=t.hasSelection()&&void 0===t.isDefaultValueEnabled()||t.isDefaultValueEnabled()===!1;e.classed("hasSelection",i)},e.isMultiSelect=function(e,t,r){return r.isSelectionModeInverted()||!t.selection.singleSelect||i.isCtrlOrMeta(e)},e.prototype.createWebBehavior=function(e){var i;switch(e.orientation){case 1:i=new t.HorizontalSlicerWebBehavior;break;case 0:default:i=new t.VerticalSlicerWebBehavior}return i},e.searchInputTimeoutDuration=500,e}();t.SlicerWebBehavior=l}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var i;!function(i){var r=jsCommon.PixelConverter,a=e.visuals.controls.SelectMenu,n=jsCommon.StringExtensions,o="slicer-header",s="slicer-select-menu",l="slicer-header-title",c="slicer-header-clear",d="slicer-header-text",u="slicer-header-selectmenu",p="foregroundDark",h="foregroundNeutralDark",v="foregroundNeutralLight",S="foregroundNeutralSecondary",m="foregroundNeutralSecondaryAlt2",g=function(){function i(e,t,r){this.services=t,this.settings=e,this.style=r,this.originalData=this.data=i.DefaultData(this.style),this.render()}return i.DefaultData=function(e){return{borderStyle:"solid",borderBottomWidth:1,show:!0,outline:t.outline.none,fontColor:t.ColorHelper.getThemeColor(e,p),textSize:9,fontFamily:t.Font.Family.regular.css,outlineColor:t.ColorHelper.getThemeColor(e,m),outlineWeight:1,searchEnabled:!1,background:null,showRestatement:!1,menu:{fontColor:t.ColorHelper.getThemeColor(e,S)},warnings:new t.VisualWarningBuilder}},i.InFocusModeData=function(e){var a=i.DefaultData(e);return a.borderStyle="none",a.background=t.ColorHelper.getThemeColor(e,v),a.textSize=r.toPoint(13),a.fontColor=t.ColorHelper.getThemeColor(e,h),a.fontFamily=t.Font.Family.regular.css,a},i.prototype.enumerateObjectInstances=function(e){var t=this.originalData;if(t){if("header"===e.objectName){var i={selector:null,objectName:"header",properties:{show:t.show,fontColor:t.fontColor,background:t.background,outline:t.outline,textSize:t.textSize,fontFamily:t.fontFamily,outlineColor:t.outlineColor,outlineWeight:t.outlineWeight}};return this.settings.supportsRestatement&&(i.properties.showRestatement=t.showRestatement),[i]}return"general"===e.objectName?[{selector:null,objectName:"general",properties:{outlineColor:t.outlineColor,outlineWeight:t.outlineWeight}}]:void 0}},i.prototype.update=function(e,t){$.extend(this.settings,t),this.settings.enableInFocusRenderers&&this.settings.isInFocus?this.data=i.InFocusModeData(this.style):(this.originalData=i.converter(e,this.style),this.data=this.services.applySlicerHeaderChanges(this.originalData)),this.updateTitle(),this.updateSelectMenu()},i.prototype.setFilterRestatement=function(e,t){this.settings.restatement=e,this.settings.supportsRestatement=t,this.updateTitleText()},i.converter=function(r,a){var n=i.DefaultData(a),o=r.objects.getStaticObjects(),s=t.ColorHelper.create(a);return o&&(n.show=e.DataViewObjects.getValue(o,t.slicerProps.header.show,n.show),n.fontColor=s.getColorForPropertyWithDefaultColor(o,t.slicerProps.header.fontColor,n.fontColor),n.menu.fontColor=s.getColorForPropertyWithDefaultColor(o,t.slicerProps.header.fontColor,n.menu.fontColor),n.background=s.getColorForPropertyWithDefaultColor(o,t.slicerProps.header.background,n.background),n.outlineColor=s.getColorForPropertyWithDefaultColor(o,t.slicerProps.general.outlineColor,n.outlineColor),n.outlineWeight=e.DataViewObjects.getValue(o,t.slicerProps.general.outlineWeight,n.outlineWeight),n.outline=e.DataViewObjects.getValue(o,t.slicerProps.header.outline,n.outline),n.textSize=e.DataViewObjects.getValue(o,t.slicerProps.header.textSize,n.textSize),n.fontFamily=e.DataViewObjects.getValue(o,t.slicerProps.header.fontFamily,n.fontFamily),n.searchEnabled=e.DataViewObjects.getValue(o,t.slicerProps.general.selfFilterEnabled,n.searchEnabled),n.showRestatement=e.DataViewObjects.getValue(o,t.slicerProps.header.showRestatement,n.showRestatement)),n},i.prototype.render=function(){this.header=InJs.DomFactory.div().addClass(o).appendTo(this.settings.host),this.addTitle(),this.addSelectMenu()},i.prototype.addSelectMenu=function(){var e=this;this.selectMenuContainer=InJs.DomFactory.div().addClass(u).toggleClass(t.SlicerUtil.Selectors.EnableHover.class,t.SlicerUtil.enableHover()).appendTo(this.title),this.selectMenuContainer.attr("title",this.services.localize("Slicer_SelectMenu_Tooltip"));var r={onChange:function(t){e.settings.onChange&&e.settings.onChange(t)},container:this.selectMenuContainer,options:this.getSelectMenuOptions(),selectedValue:this.settings.selectedValue,className:s,disabled:2===this.settings.visibilityState};this.selectMenu=new a(r),i.addHoverInOut(this.settings.hoverContainer,function(){0!==e.services.getViewMode()&&e.selectMenuContainer.show()},function(){e.settings.areControlButtonsAlwaysVisible||e.selectMenuContainer.hide()})},i.prototype.addTitle=function(){var e=this;this.title=InJs.DomFactory.div().addClass(l).appendTo(this.header),this.clearButton=InJs.DomFactory.span().addClass(c).toggleClass(t.SlicerUtil.Selectors.EnableHover.class,t.SlicerUtil.enableHover()).attr("title",this.services.localize(t.SlicerUtil.DisplayNameKeys.Clear)).attr("role","button").attr("tabindex","0").on("keydown",function(t){32!==t.keyCode&&13!==t.keyCode||e.settings.onClear&&(e.settings.onClear(),t.stopPropagation())}).appendTo(this.title),this.clearButton.click(function(){e.settings.onClear&&e.settings.onClear()}),i.addHoverInOut(this.settings.hoverContainer,function(){e.clearButton.show()},function(){e.settings.areControlButtonsAlwaysVisible||e.clearButton.hide()}),this.textElement=$("<h2 />").addClass(d).appendTo(this.title)},i.prototype.updateTitle=function(){if(this.data.show){var e=!1;if(this.settings.areControlButtonsAlwaysVisible&&(this.clearButton.show(),this.selectMenuContainer.show()),this.data.searchEnabled){var a=i.DefaultData(this.style);e=this.data.outline===a.outline&&this.data.outlineWeight===a.outlineWeight&&this.data.outlineColor===a.outlineColor}this.title.show(),this.title.css({"border-style":e?"none":this.data.borderStyle,"border-color":this.data.outlineColor,"border-width":t.VisualBorderUtil.getBorderWidth(this.data.outline,this.data.outlineWeight),"background-color":_.isEmpty(this.data.background)?"":this.data.background}),this.textElement.css({"font-size":r.fromPoint(this.data.textSize),"font-family":this.data.fontFamily,color:this.data.fontColor}),this.updateTitleText()}else this.title.hide()},i.prototype.updateTitleText=function(){var e=this.settings.text;if(this.data.showRestatement&&this.settings.restatement){var t=this.services.localize("NamePattern_Colon");e=n.format(t,e,this.settings.restatement)}this.textElement.text(e).attr("title",e)},i.prototype.updateSelectMenu=function(){0===this.services.getViewMode()?this.selectMenuContainer.hide():this.selectMenu.update({options:this.getSelectMenuOptions(),selectedValue:this.settings.selectedValue,disabled:2===this.settings.visibilityState})},i.prototype.getSelectMenuOptions=function(){for(var e=[],t=this.settings.slicerModeOptions,i=0,r=t;i<r.length;i++){var a=r[i],n=a.displayName({get:this.services.localize});e.push({text:n,value:a.value})}return e},i.prototype.addWarnings=function(e){t.SlicerUtil.addWarningsToSlicerVisual(this.data.warnings,e)},i.addHoverInOut=function(e,i,r){t.SlicerUtil.enableHover()&&e.hover(i,r)},i}();i.SlicerHeader=g}(i=t.controls||(t.controls={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var i,r=jsCommon.BrowserUtils,a=jsCommon.Color,n=jsCommon.PixelConverter,o=e.data.SQExpr,s=e.data.SQExprBuilder,l=e.data.SemanticFilter;!function(i){function c(e,t){var i=s.text(t),r=s.contains(e,i);return l.fromSQExpr(r)}function d(t,i,r){if(!t||_.isEmpty(i))return!1;for(var a=0,n=i.length;a<n;a++){var o=i[a];if(e.DataViewScopeIdentity.equals(t,o,r))return i.splice(a,1),!0}return!1}function u(e,t){if(t&&!_.isEmpty(e)){var r=t&&t.categorical&&t.categorical.categories,a=_.head(r);return a&&a.source&&a.source.expr?i.getContainsFilter(a.source.expr,e):void 0}}function p(e){if(_.isEmpty(e))return[];var t=[];return e.forEach(function(e){var i=e.metadata&&e.metadata.columns;_.chain(i).map(function(e){return e.expr}).filter(function(e){return e&&(o.isColumn(e)||o.isMeasure(e)||o.isHierarchyLevel(e))}).value().forEach(function(e){t.push(e)})}),t}function h(e,i){var r,a={remove:[{objectName:"general",selector:null,properties:{filter:!0}}],replace:[{objectName:"data",selector:null,properties:(r={},r[t.slicerProps.data.mode.propertyName]=i,r)}]};e.persistProperties(a),e.onSelect({visualObjects:[]})}function v(e,t){var i=e.complete(),r=i?i.visualObjectWarnings:void 0;for(var a in r)t.addForVisualObject.apply(t,[a].concat(r[a]))}function S(e,i){if(i&&!_.isEmpty(i.slicerDataPoints))for(var r=i.slicerDataPoints.length,a=0;a<r;a++){var n=i.slicerDataPoints[a];if(n===e||t.SelectionId.isEqual(n.identity,e.identity))return a}return-1}function m(){return!r.isIOSWebView()&&!r.isAndroidWebView()}var g;!function(e){var t=jsCommon.CssConstants.createClassAndSelector;e.ClearSearchTextButton=t("clearSearchTextButton"),e.HeaderContainer=t("headerContainer"),e.Header=t("slicerHeader"),e.Hidden=t("hidden"),e.Icon=t("icon"),e.TitleHeader=t("titleHeader"),e.HeaderText=t("headerText"),e.Body=t("slicerBody"),e.Label=t("slicerLabel"),e.LabelText=t("slicerText"),e.LabelImage=t("slicerImage"),e.CountText=t("slicerCountText"),e.Clear=t("clear"),e.SearchHeader=t("searchHeader"),e.SearchIconClass=t("searchIcon"),e.SearchInput=t("searchInput"),e.SearchHeaderCollapsed=t("collapsed"),e.SearchHeaderShow=t("show"),e.MultiSelectEnabled=t("isMultiSelectEnabled"),e.EnableHover=t("enable-hover")}(g=i.Selectors||(i.Selectors={}));var f;!function(e){e.Clear="Slicer_Clear",e.SelectAll="SelectAll",e.Search="SearchBox_Text"}(f=i.DisplayNameKeys||(i.DisplayNameKeys={}));var y;!function(e){function t(e){return null!=e&&null!=e.slicerSettings}e.areSettingsDefined=t}(y=i.SettingsHelper||(i.SettingsHelper={}));var b;!function(e){function t(e){if(e){var t=e.categorical;if(t&&!_.isEmpty(t.categories))return t.categories[0].identityFields}}e.getIdentityFields=t}(b=i.DefaultValueHandler||(i.DefaultValueHandler={})),i.getContainsFilter=c,i.tryRemoveValueFromRetainedList=d,i.getUpdatedSelfFilter=u,i.getSlicerTargets=p,i.clearSlicerFilter=h,i.addWarningsToSlicerVisual=v,i.getDataPointIndex=S;var C=function(){function e(){}return e.prototype.onPopupHideEvent=function(e,t){var i=this;return this.popupHideEventHandler=e,this.boundBox=t,this.originalOffset=$(t).offset(),this.scrollEventHandler=function(e){return i.scrollEventReceived(e)},this.popupHideEvent=function(e){return i.popupHideEventReceived(e)},this.bindPopupHideHandlers(),$.proxy(this.unbindPopupHideHandlers,this)},e.prototype.popupHideEventReceived=function(e){this.popupHideEventHandler(e.type,e.target)},e.prototype.scrollEventReceived=function(e){if(this.boundBox){var t=$(this.boundBox).offset();t.left===this.originalOffset.left&&t.top===this.originalOffset.top||(this.originalOffset=t,this.popupHideEventHandler(e.type,e.target))}},e.prototype.bindPopupHideHandlers=function(){document.addEventListener("mousedown",this.popupHideEvent,!0),document.addEventListener("pointerdown",this.popupHideEvent,!0),document.addEventListener("touchstart",this.popupHideEvent,!0),$(window).on("resize",$.proxy(this.popupHideEventReceived,this)),$(this.boundBox).on("destroy",$.proxy(this.popupHideEventReceived,this)),document.addEventListener("scroll",this.scrollEventHandler,!0)},e.prototype.unbindPopupHideHandlers=function(){document.removeEventListener("mousedown",this.popupHideEvent,!0),document.removeEventListener("pointerdown",this.popupHideEvent,!0),document.removeEventListener("touchstart",this.popupHideEvent,!0),$(window).off("resize",this.popupHideEventReceived),document.removeEventListener("scroll",this.scrollEventHandler,!0),$(this.boundBox).off("destroy",this.popupHideEventReceived)},e.exploreCanvasSelector=".exploreCanvas",e.canvasPopoutSelector=".canvasPopout",e}();i.EventsHelper=C;var w=function(){function r(){}return r.prototype.addSearch=function(e,t){var i=t.append("div").classed(g.SearchHeader.class,!0).classed(g.SearchHeaderCollapsed.class,!0);return i.append("span").classed("powervisuals-glyph search",!0).classed(g.Icon.class,!0).classed(g.SearchIconClass.class,!0).attr("title",e.getLocalizedString(f.Search)),i.append("input").attr("type","text").classed(g.SearchInput.class,!0).attr("drag-resize-disabled","true"),i},r.prototype.addClearSearchButton=function(e,t){var r=t.append("span").classed("powervisuals-glyph x",!0).classed(g.Icon.class,!0).classed(g.ClearSearchTextButton.class,!0);return t.select(i.Selectors.SearchInput.selector).attr("placeholder",e.getLocalizedString(f.Search)),r},r.prototype.configureSearchBoxIcon=function(e,t){var r=_.isEmpty(t);e.select(i.Selectors.SearchIconClass.selector).classed(i.Selectors.Hidden.class,!r),e.select(i.Selectors.ClearSearchTextButton.selector).classed(i.Selectors.Hidden.class,r)},r.prototype.getRowHeight=function(t,i){return e.TextMeasurementService.estimateSvgTextHeight(this.getTextProperties(t.slicerText.textSize,t.slicerText.fontFamily,i))+this.getRowsOutlineWidth(t.slicerText.outline,t.general.outlineWeight)},r.prototype.setSlicerTextStyle=function(e,i){e.style({color:i.slicerText.color,"background-color":i.slicerText.background,"border-style":"solid","border-color":i.general.outlineColor,"border-width":t.VisualBorderUtil.getBorderWidth(i.slicerText.outline,i.general.outlineWeight),"font-size":n.fromPoint(i.slicerText.textSize),"font-family":i.slicerText.fontFamily,"line-height":Math.floor(1.79*i.slicerText.textSize)+"px"});var r=this.calculateSlicerTextHighlightColor(i.slicerText.color);e.on("mouseover",function(e){d3.select(this).style({color:r})}),e.on("mouseout",function(e){d3.select(this).style({color:i.slicerText.color})})},r.prototype.getRowsOutlineWidth=function(e,i){switch(e){case t.outline.none:case t.outline.leftRight:return 0;case t.outline.bottomOnly:case t.outline.topOnly:return i;case t.outline.topBottom:case t.outline.frame:return 2*i;default:return 0}},r.prototype.calculateSlicerTextHighlightColor=function(e){var t=a.parseColorString(e);return 255===t.R&&255===t.G&&255===t.B?"#C8C8C8":a.calculateHighlightColor(t,.8,.2)},r.prototype.getTextProperties=function(e,t,i){return i.fontSize=n.fromPoint(e),i.fontFamily=t,i},r}();i.DOMHelper=w,i.enableHover=m}(i=t.SlicerUtil||(t.SlicerUtil={})),function(e){var t;!function(t){function i(e,t,i,o){if(t)switch(e.objectName){case"items":return n(t,i);case"selection":if(r(o))return a(t,i)}}function r(e){return!(e&&e.metadata&&e.metadata.columns&&_.some(e.metadata.columns,function(e){return e.discourageAggregationAcrossGroups}))}function a(t,i){var r=i;return[{selector:null,objectName:"selection",properties:{selectAllCheckboxEnabled:e.SettingsHelper.areSettingsDefined(t)&&t.slicerSettings.selection&&t.slicerSettings.selection.selectAllCheckboxEnabled?t.slicerSettings.selection.selectAllCheckboxEnabled:r.selection.selectAllCheckboxEnabled,singleSelect:t&&t.slicerSettings&&t.slicerSettings.selection&&void 0!==t.slicerSettings.selection.singleSelect?t.slicerSettings.selection.singleSelect:r.selection.singleSelect
}}]}function n(t,i){var r=i,a=e.SettingsHelper.areSettingsDefined(t)&&t.slicerSettings.slicerText;return[{selector:null,objectName:"items",properties:{fontColor:a&&t.slicerSettings.slicerText.color?t.slicerSettings.slicerText.color:r.slicerText.color,background:a&&t.slicerSettings.slicerText.background?t.slicerSettings.slicerText.background:r.slicerText.background,outline:r.slicerText.outline,textSize:r.slicerText.textSize,fontFamily:r.slicerText.fontFamily}}]}t.enumerateObjectInstances=i}(t=e.ObjectEnumerator||(e.ObjectEnumerator={}))}(i=t.SlicerUtil||(t.SlicerUtil={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var i=e.visuals.slicerMode,r=e.visuals.SlicerResponsiveBreakpoints,a=function(){function e(){}return e.prototype.applySlicerChanges=function(e,t,i){return this.shouldApplyResponsiveChanges(i,t.mode,t.orientation)&&(t=this.applyResponsiveSlicerChanges(e,t)),t},e.prototype.applySlicerHeaderChanges=function(e,t,i,r){return this.shouldApplyResponsiveChanges(i,r.mode,r.orientation)&&(t=this.applyResponsiveSlicerHeaderChanges(e,t,r)),t},e.prototype.enumerateObjectInstances=function(e,t,i,r,a){this.doesSlicerModeSupportsResponsive(r,a)&&"general"===e.objectName&&this.enumerateGeneral(i,t)},e.prototype.enumerateGeneral=function(e,i){var r=t.ViewModelAdapterUtils.getResponsiveVisualProperties(e,t.slicerProps),a={selector:null,properties:{responsive:r.responsive},objectName:"general"};_.merge(i[0],a)},e.prototype.shouldApplyResponsiveChanges=function(e,i,r){return this.doesSlicerModeSupportsResponsive(i,r)&&t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(e,t.slicerProps)},e.prototype.doesSlicerModeSupportsResponsive=function(t,i){return e.isRangeSlicerMode(t)||e.isHorizontalSlicer(t,i)},e.prototype.applyResponsiveSlicerChanges=function(e,i){var r=t.ViewModelAdapterUtils.cloneData(i);return this.applyIconResponsiveChanges(e,r),this.applyResponsiveSlicerHorizontalChanges(r),this.updateResponsiveWarnings(r,i),r},e.prototype.applyResponsiveSlicerHeaderChanges=function(e,i,r){var a=t.ViewModelAdapterUtils.cloneData(i);return this.applyHeaderChanges(e,r,a),this.updateResponsiveHeaderWarnings(a,i),a},e.prototype.applyIconResponsiveChanges=function(t,i){var a;e.isRangeSlicerMode(i.mode)?a=r.rangeSlicer.iconBreakpoints:e.isHorizontalSlicer(i.mode,i.orientation)&&(a=r.horizontalSlicer.iconBreakpoints),_.some(a,function(e){return t.height<=e.height&&t.width<=e.width})&&(i.showIcon=!0)},e.prototype.applyResponsiveSlicerHorizontalChanges=function(t){e.isHorizontalSlicer(t.mode,t.orientation)&&(t.showTabularSlicer=!0)},e.prototype.applyHeaderChanges=function(i,a,n){var o;e.isRangeSlicerMode(a.mode)?o=r.rangeSlicer:e.isHorizontalSlicer(a.mode,a.orientation)&&(o=r.horizontalSlicer),o&&i.height<o.hideHeaderHeight&&(n.show=!1);var s=t.SlicerViewModelAdapterUtils.resolveMaxFontSizePtForViewport(i,r.slicerHeader.fontSize);n.textSize=Math.min(n.textSize,s)},e.prototype.updateResponsiveWarnings=function(e,t){},e.prototype.updateResponsiveHeaderWarnings=function(e,i){var r;if(e.show!==i.show?r=new t.SlicerHeaderNotRenderedWarning:e.textSize!==i.textSize&&(r=new t.SlicerHeaderFontSizeWarning),r){var a={selector:null,warnings:[r]};e.warnings.addForVisualObject("header",a)}},e.isRangeSlicerMode=function(e){return i.isRangeSlicerMode(e)},e.isHorizontalSlicer=function(e,t){return e===i.basic&&1===t},e}();t.SlicerViewModelAdapter=a}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var i=function(){function i(){}return i.prototype.applyChanges=function(e,i,r){return t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(r,t.slicerProps)&&(i=this.applyResponsiveRangeSlicerChanges(e,i)),i},i.prototype.applyResponsiveRangeSlicerChanges=function(t,i){var r=e.Prototype.inherit(i);return this.applyRangeSlicerDataChanges(r),this.applySliderChanges(r),r},i.prototype.applySliderChanges=function(t){t.sliderSettings=e.Prototype.inherit(t.sliderSettings),t.sliderSettings.drawRoundSliderHandles=!0,t.sliderSettings.minSliderVisibilityHeight=i.MinSliderVisibilityHeight,t.sliderSettings.minSliderVisibilityWidth=i.MinSliderVisibilityWidth},i.prototype.applyRangeSlicerDataChanges=function(e){e.wrapRangeBoxes=!0},i.MinSliderVisibilityHeight=35,i.MinSliderVisibilityWidth=0,i}();t.RangeSlicerViewModelAdapter=i}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var i=function(){function i(){}return i.prototype.applyChanges=function(e,i,r){var a=i;return t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(r,t.slicerProps)&&(a=this.applyResponsiveSlicerChanges(e,a),this.updateWarnings(a,i)),a},i.prototype.applyResponsiveSlicerChanges=function(t,i){var r=e.Prototype.inherit(i);return this.applyFontSizeChanges(t,r),r},i.prototype.applyFontSizeChanges=function(i,r){var a=t.SlicerViewModelAdapterUtils.resolveMaxFontSizePtForViewport(i,t.SlicerResponsiveBreakpoints.horizontalSlicer.fontSize);r.slicerSettings.slicerText.textSize>a&&(r.slicerSettings=e.Prototype.inherit(r.slicerSettings),r.slicerSettings.slicerText=e.Prototype.inherit(r.slicerSettings.slicerText),r.slicerSettings.slicerText.textSize=a)},i.prototype.updateWarnings=function(e,i){if(e.slicerSettings.slicerText.textSize!==i.slicerSettings.slicerText.textSize){var r=new t.HorizontalSlicerFontSizeWarning,a={selector:null,warnings:[r]};e.warnings.addForVisualObject("items",a)}},i}();t.HorizontalSlicerViewModelAdapter=i}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var i=jsCommon.Utility.clampValue,r=function(){function r(){}return r.prototype.renderCore=function(e){e.classed(a.Tabular.class,!0)},r.prototype.bindData=function(e,i,r){return this.renderColumns(e,r).selectAll(t.HorizontalSlicer.Selectors.IndividualItemContainer.selector).data(function(e){return e},function(e){return t.SlicerUtil.getDataPointIndex(e,i)})},r.prototype.renderColumns=function(e,t){var i=this.numberOfRows,r=_.chunk(e,i),n=t.selectAll(a.ColumnItemContainer.selector).style("height",null).data(r);return n.exit().remove(),n.enter().append("div").classed(a.ColumnItemContainer.class,!0),this.scaleLastColumnIfNeeded(i,r,t),n},r.prototype.scaleLastColumnIfNeeded=function(t,i,r){var n=_.last(i).length;if(n<t){var o=r.select(a.ColumnItemContainer.selector+":last-child"),s=e.Double.roundToPrecision(100*n/t,.01);o.style("height",s+"%")}},r.prototype.getScrollSize=function(e){return this.numberOfRows},r.prototype.getLastStartIndex=function(e,t){if(t<=e)return 0;var i=0,r=this.numberOfRows,a=t%r;a>0&&(i=r-a);var n=t-e+i;return Math.max(n,0)},r.prototype.calculateTotalItemDimensions=function(e,t){return e=Math.max(e,r.MinItemWidth),t=Math.max(t,r.MinItemHeight),t+=2*r.TabularMargin,e+=2*r.TabularMargin,{width:e,height:t}},r.prototype.calculateNumberOfItemsToDisplay=function(e,i,a,n){var o=e.find(t.SlicerUtil.Selectors.Body.selector),s=o.width()-2*r.NavigationArrowWidth,l=o.height(),c={height:l,width:s},d={height:a,width:i};return this.calculateTableDimensions(c,d,n)},r.prototype.calculateTableDimensions=function(e,t,r){var a=t.width,n=t.height,o=e.width,s=e.height;if(0===a)return 0;var l=Math.floor(o/a);this.numberOfRows=0===n?1:Math.floor(s/n),this.numberOfRows=i(this.numberOfRows,1,r);var c=Math.ceil(Math.sqrt(r));return l>=c&&this.numberOfRows>=c?this.numberOfRows=l=c:this.numberOfRows>=r&&l>1&&(this.numberOfRows=Math.ceil(this.numberOfRows/l)),i(this.numberOfRows*l,this.numberOfRows,r)},r.prototype.getNavigationArrowsClass=function(e){var i,r;return e?(i={},i[a.TabularNavigationArrow.class]=!0,i[t.HorizontalSlicer.Selectors.LeftNavigationArrow.class]=!0,i[a.PbiVisualsGlyph.class]=!0,i[a.TabularLeftNavigationArrow.class]=!0,i):(r={},r[a.TabularNavigationArrow.class]=!0,r[t.HorizontalSlicer.Selectors.RightNavigationArrow.class]=!0,r[a.PbiVisualsGlyph.class]=!0,r[a.TabularRightNavigationArrow.class]=!0,r)},r.prototype.getDataPointRightMargin=function(e,t){return"0px"},r.MinItemWidth=40,r.MinItemHeight=40,r.TabularMargin=2,r.NavigationArrowWidth=19,r}();t.TabularSlicerLayout=r;var a;!function(e){var t=jsCommon.CssConstants.createClassAndSelector;e.Tabular=t("tabular"),e.ColumnItemContainer=t("columnItemContainer"),e.PbiVisualsGlyph=t("powervisuals-glyph"),e.TabularNavigationArrow=t("tabularNavigationArrow"),e.TabularLeftNavigationArrow=t("left-nav-arrow"),e.TabularRightNavigationArrow=t("right-nav-arrow")}(a||(a={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=jsCommon.PixelConverter,i=function(){function i(t,i,r){void 0===r&&(r=!0),this.lockKeyboardNavigation=r,this.textProperties={fontFamily:e.Font.Family.regular.css,fontSize:"14px"},this.hasSearchableData=!1,this.scrollPositionStack=[],this.rowHeight=0,this.defaultMinWidth=50,this.verticalSlicerStrategy=t,i&&(this.behavior=i.behavior),this.domHelper=new e.SlicerUtil.DOMHelper,this.hostServices=i.hostServices}return i.prototype.getDefaultValue=function(){if(this.data&&this.data.defaultValue)return this.data.defaultValue.value},i.prototype.getIdentityFields=function(){return e.SlicerUtil.DefaultValueHandler.getIdentityFields(this.dataView)},i.prototype.getUpdatedSelfFilter=function(t){if(this.data.searchKey!==t)return e.SlicerUtil.getUpdatedSelfFilter(t,this.dataView)},i.prototype.supportsOrientation=function(){return!0},i.prototype.enumerateObjectInstances=function(t){return e.SlicerUtil.ObjectEnumerator.enumerateObjectInstances(t,this.data,this.settings,this.dataView)},i.prototype.onModeChange=function(t){e.SlicerUtil.clearSlicerFilter(this.hostServices,t)},i.prototype.getRestatement=function(){return this.data&&this.data.restatement},i.prototype.onClear=function(){this.interactivityService.handleClearSelection(),this.interactivityService.persistSelectionFilter(e.slicerProps.filterPropertyIdentifier)},i.prototype.init=function(t,i){var a=this;this.element=i,this.currentViewport=t.visualInitOptions.viewport;var n=this.hostServices=t.visualInitOptions.host;this.style=t.visualInitOptions.style;var o,s=this.settings=e.DataConversion.DefaultSlicerProperties(this.style),l=this.domHelper;this.behavior&&(o=e.createInteractivityService(n));var c=document.createElement("div");c.className=r.Container.class;var d=this.container=d3.select(c);this.searchContainer=l.addSearch(n,d),this.verticalSlicerStrategy.hasClearSearchButton()&&(this.clearSearchTextButton=l.addClearSearchButton(n,this.searchContainer)),this.createBodyElement();var u=function(e){a.onEnterSelection(e)},p=function(e){a.onUpdateSelection(e,o)},h=function(e){e.remove()},v={rowHeight:l.getRowHeight(s,this.textProperties),enter:u,exit:h,update:p,loadMoreData:function(){return t.loadMoreData()},scrollEnabled:!0,viewport:this.currentViewport,baseContainer:this.body,isReadMode:function(){return 1!==a.hostServices.getViewMode()},scrollToFrame:t.enableMultiElementRows?function(e,t,i,r,n,o,s){return a.scrollToFrameForMultiElementRow(e,t,i,r,n,o,s)}:void 0};return this.listView=e.ListViewFactory.createListView(v),this.element.get(0).appendChild(c),this.interactivityService=o,o},i.prototype.render=function(e){this.renderVerticalSlicer(this.converter(e.dataView),e)},i.prototype.renderVerticalSlicer=function(t,i){var r=this;return this.currentViewport=i.viewport,this.hasSearchableData=i.hasSearchableData,i.dataView&&this.data&&!_.isEmpty(this.data.slicerDataPoints)?(this.updateSelectionStyle(),void this.listView.viewport(this.currentViewport).data(this.data.slicerDataPoints,function(t){return e.SlicerUtil.getDataPointIndex(t,r.data)},i.resetScrollbarPosition)):void(this.listView&&this.listView.empty())},i.prototype.converter=function(t){var i=this.hostServices.getLocalizedString(e.SlicerUtil.DisplayNameKeys.SelectAll),r=e.DataConversion.convert(t,i,this.interactivityService,this.hostServices,this.style);return this.data=r,t&&this.data&&(this.settings=r.slicerSettings,this.dataView=t),r},i.prototype.hasSearchEnabled=function(){return this.verticalSlicerStrategy.shouldShowSearchHeader(this.settings,this.hasSearchableData)},i.prototype.updateSelectionStyle=function(){var e=this.settings;this.container.classed("isMultiSelectEnabled",e&&e.selection&&!e.selection.singleSelect)},i.prototype.onEnterSelection=function(i){var a=this.settings,n=i.append("ul").append("li").classed(r.ItemContainer.class,!0),o=n.append("div").classed(r.Input.class,!0);o.append("input").attr("type","checkbox"),this.verticalSlicerStrategy.customizeInputElement(o),n.each(function(i,r){var n=d3.select(this);n.attr("tabindex","-1").attr("role","checkbox").attr("aria-checked",i.selected?"true":"false"),i.isImage?n.append("img").classed(e.SlicerUtil.Selectors.LabelImage.class,!0):n.append("span").classed(e.SlicerUtil.Selectors.LabelText.class,!0),null!=i.count&&n.append("span").classed(e.SlicerUtil.Selectors.CountText.class,!0).style({"font-size":t.fromPoint(a.slicerText.textSize),"font-family":a.slicerText.fontFamily})})},i.prototype.onUpdateSelection=function(i,a){var n=this.settings,o=this.data;if(o&&n){var s=this.domHelper;i.select(r.ItemContainer.selector);var l=this.verticalSlicerStrategy.shouldShowSearchHeader(n,this.hasSearchableData);this.searchContainer.classed(e.SlicerUtil.Selectors.SearchHeaderShow.class,l),this.searchContainer.classed(e.SlicerUtil.Selectors.SearchHeaderCollapsed.class,!l);var c=i.selectAll(e.SlicerUtil.Selectors.LabelText.selector);c.text(function(e){return e.value}).attr("title",function(e){return e.tooltip}),this.verticalSlicerStrategy.setLabelTextStyle(s,c,n,this.style);var d=i.selectAll(e.SlicerUtil.Selectors.LabelImage.selector);d.empty()||d.attr("src",function(e){return e.value});var u=i.selectAll(e.SlicerUtil.Selectors.CountText.selector);if(!u.empty()&&this.verticalSlicerStrategy.shouldShowCount()&&(u.text(function(e){return e.count}),s.setSlicerTextStyle(u,n)),a&&this.body){var p=this.body.attr("width",this.currentViewport.width),h=p.selectAll(r.ItemContainer.selector),v=p.selectAll(e.SlicerUtil.Selectors.LabelText.selector),S=p.selectAll(r.Input.selector),m=this.searchContainer.select(e.SlicerUtil.Selectors.SearchInput.selector),g=this.searchContainer.select(e.SlicerUtil.Selectors.SearchIconClass.selector);if(!m.empty()){var f=m.node(),y=f&&f.value;this.verticalSlicerStrategy.hasClearSearchButton()&&this.domHelper.configureSearchBoxIcon(this.searchContainer,y),(_.isEmpty(y)||_.isEmpty(o.searchKey))&&m.property("value",o.searchKey),this.searchContainer.style({color:n.search.color,"border-style":n.search.outline,"border-color":n.search.borderColor,background:n.search.background}),m.style({background:n.search.background,color:n.search.color,"font-size":t.fromPoint(n.search.textSize),"font-family":n.search.fontFamily}),g.style({color:n.search.color})}var b={dataPoints:o.slicerDataPoints,slicerContainer:this.container,itemContainers:h,itemLabels:v,itemInputs:S,interactivityService:a,settings:o.slicerSettings,searchInput:m,clearSearchTextButton:this.clearSearchTextButton,slicerValueHandler:this,style:this.style},C={behaviorOptions:b,orientation:0};a.bind(o.slicerDataPoints,this.behavior,C,{overrideSelectionFromData:!0,hasSelectionOverride:o.hasSelectionOverride,slicerValueHandler:this}),e.SlicerWebBehavior.styleSlicerItems(i.select(r.Input.selector),o.hasSelectionOverride,a.isSelectionModeInverted(),this.style)}else e.SlicerWebBehavior.styleSlicerItems(i.select(r.Input.selector),!1,!1,this.style)}},i.prototype.scrollToFrameForMultiElementRow=function(t,i,r,a,n,o,s){this.rowHeight=Math.max(r,this.rowHeight);var l=0===a?0:Math.floor(a/this.rowHeight);if(!(this.currentRowPosition&&l===this.currentRowPosition||l<0)){var c=e.SVGUtil.translateWithPixels(0,l*this.rowHeight);o.style({transform:function(e){return c},"-webkit-transform":c});var d=o.selectAll(".row").filter(function(){return""!==this.textContent});void 0===this.currentRowPosition?(this.currentPosition=this.getInitialPosition(n,s),d&&d.node()&&(this.currentRowPosition=l)):(this.updateCurrentPosition(l,n,s,o,d),this.currentRowPosition=l),t.performScrollToFrame(this.currentPosition.position0,this.currentPosition.position1,n,this.currentPosition.position1-this.currentPosition.position0,i)}},i.prototype.getInitialPosition=function(e,t){return{position0:0,position1:Math.min(e,Math.ceil($(t.node()).outerHeight()/this.rowHeight)*Math.floor($(t.node()).outerWidth()/this.defaultMinWidth))}},i.prototype.updateCurrentPosition=function(e,t,i,r,a){var n=Math.abs(e-this.currentRowPosition);if(e===this.currentRowPosition)this.currentPosition=this.scrollPositionStack.pop()||this.getInitialPosition(t,i);else if(e<this.currentRowPosition)for(;n>0;)this.currentPosition=this.scrollPositionStack.pop()||this.currentPosition,n--;else for(;n>0;){var o=Math.ceil($(i.node()).outerHeight()/$(a.node()).outerHeight());if(this.currentPosition.position0>=t-1)return;this.scrollPositionStack.push(this.currentPosition);var s=this.getElementsPerRow(r,o,a),l=this.currentPosition.position0+s[0];this.currentPosition={position0:l,position1:Math.min(t,l+_.sum(s)+this.getMaxElementsInRow(r,a))},n--}},i.prototype.getElementsPerRow=function(e,t,i){for(var r=[],a=i.node(),n=0;n<t&&null!==a;n++){r.push(0);for(var o=$(a).position().top;null!==a&&$(a).position().top<=o+5;)r[n]++,a=a.nextElementSibling}return r},i.prototype.getMaxElementsInRow=function(e,t){var i=t.node().getAttribute("min-width");return i?$(e.node()).outerWidth()/+i:Math.floor($(e.node()).outerWidth()/this.defaultMinWidth)},i.prototype.createBodyElement=function(){var t=this;this.body=this.container.append("div").classed(e.SlicerUtil.Selectors.Body.class,!0),this.body.attr("tabindex","0").on("keydown",function(){var e;40===d3.event.keyCode?(e=t.focusNextElement(document.activeElement,!0),d3.event.stopPropagation()):38===d3.event.keyCode?(e=t.focusNextElement(document.activeElement,!1),d3.event.stopPropagation()):9===d3.event.keyCode&&t.lockKeyboardNavigation&&t.body.node().focus(),e&&d3.event.preventDefault()})},i.prototype.focusNextElement=function(t,i){if(t.classList.contains(e.SlicerUtil.Selectors.Body.class)){var a=$(t).find(r.ItemContainer.selector).first();return!!a&&(a.attr("tabindex","0"),a.focus(),!0)}$(t).attr("tabindex","-1");var n=t.parentElement.parentElement;if(n){var o=i?n.nextElementSibling:n.previousElementSibling;if(o){var a=o.firstElementChild.firstElementChild;return $(a).attr("tabindex","0"),a.focus(),!0}}return!1},i}();e.VerticalSlicerRenderer=i,function(i){var r=function(){function e(){}return e.prototype.hasClearSearchButton=function(){return!1},e.prototype.setLabelTextStyle=function(e,t,i){e.setSlicerTextStyle(t,i)},e.prototype.shouldShowSearchHeader=function(e,t){return e.search.enabled&&t},e.prototype.shouldShowCount=function(){return!0},e.prototype.customizeInputElement=function(e){e.append("span").classed("checkbox",!0)},e}();i.CheckBoxSlicerStrategy=r;var a=13,n=e.Font.Family.regular.css,o=function(){function i(){}return i.prototype.hasClearSearchButton=function(){return!0},i.prototype.setLabelTextStyle=function(i,r,o,s){var l=e.DataConversion.DefaultSlicerProperties(s);l.slicerText.textSize=t.toPoint(a),l.slicerText.fontFamily=n,l.slicerText.color=e.ColorHelper.getThemeColor(s,e.ForegroundColorName),i.setSlicerTextStyle(r,l)},i.prototype.shouldShowSearchHeader=function(e,t){return e.search.enabled||t},i.prototype.shouldShowCount=function(){return!1},i.prototype.customizeInputElement=function(e){e.append("span").classed("powervisuals-glyph checkmark",!0)},i}();i.CheckListSlicerStrategy=o}(i=e.VerticalSlicerRenderer||(e.VerticalSlicerRenderer={}));var r;!function(e){var t=jsCommon.CssConstants.createClassAndSelector;e.Container=t("slicerContainer"),e.ItemContainer=t("slicerItemContainer"),e.Input=t("slicerCheckbox"),e.Checkbox=t("checkbox")}(r||(r={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t=function(){function t(){}return t.prototype.bindEvents=function(t,i){var r=t.itemContainers;this.itemLabels=t.itemLabels,this.itemInputs=t.itemInputs,this.dataPoints=t.dataPoints,this.interactivityService=t.interactivityService,this.settings=t.settings,this.style=t.style,e.SlicerWebBehavior.bindSlicerEvents(t,r,i,this.settings,this.interactivityService)},t.prototype.renderSelection=function(t){e.SlicerWebBehavior.setSelectionOnSlicerItems(this.itemInputs,this.itemLabels,t,this.interactivityService,this.settings,this.style)},t}();e.VerticalSlicerWebBehavior=t}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));